<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>VBMS Training Module</title>
  <meta name="viewport" content="width=device-width,initial-scale=1.0"/>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"/>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet"/>
  <style>
    body { background: #0a0a0a; color: #fff; font-family: 'Inter', sans-serif; }
    .sidebar { width: 240px; background: #131313; height: 100vh; position: fixed; top:0; left:0; z-index: 2; padding:32px 0 0 0;}
    .sidebar .logo { color: #f0b90b; font-weight: bold; text-align: center; margin-bottom: 2rem; }
    .sidebar a { color:#fff; text-decoration:none; display: block; padding: 14px 32px; transition:.2s; }
    .sidebar a.active, .sidebar a:hover { background: #f0b90b; color:#000; }
    .main { margin-left:240px; min-height:100vh; padding:32px 40px 32px 40px; }
    .training-header { font-size: 2rem; font-weight: bold; margin-bottom: 10px; }
    .admin-toggle { float:right; }
    .lesson-list { background:#1b1b1b; padding:24px; border-radius:12px; min-height:430px;}
    .lesson-list .lesson-row { padding:10px; border-radius:8px; cursor:pointer; margin-bottom:4px;}
    .lesson-row.active, .lesson-row:hover { background:#313131; color:#f0b90b; }
    .lesson-row .bi { margin-right:8px;}
    .progress-bar { background: #f0b90b; }
    .lesson-editor { border:1px solid #313131; border-radius:10px; background:#151515; padding:20px;}
    .admin-panel { background:#181818; border-radius:10px; padding:22px; margin-bottom:18px;}
    .btn-warning { color: #000; font-weight: bold;}
    .quiz-box { background:#1b1b1b; border-radius:10px; padding:18px; margin-top:14px;}
    .resource-link { color:#ffe066; font-size: 1.05em;}
    .cert { background: #131313; border: 2px solid #f0b90b; color:#ffe066; border-radius:12px; padding:32px; text-align:center; margin:30px auto; max-width:420px;}
    .note-area { background:#1c1c1c; color:#fff; border-radius:8px; border:none; padding:10px;}
    .lesson-complete-badge { font-size:0.93em; color:#28e07b; margin-left:8px;}
    @media (max-width:900px){
      .main {margin-left:0; padding:12px;}
      .sidebar {position:static; width:100%; height:auto;}
    }
  </style>
</head>
<body>
  <!-- Sidebar -->
  <div class="sidebar">
    <div class="logo">
      <i class="bi bi-play-btn"></i> VBMS<br>Training
    </div>
    <a href="dashboard.html"><i class="bi bi-speedometer"></i> Dashboard</a>
    <a href="#" class="active"><i class="bi bi-mortarboard"></i> Training</a>
    <a href="settings.html"><i class="bi bi-gear"></i> Settings</a>
    <a href="logout.html"><i class="bi bi-box-arrow-left"></i> Logout</a>
  </div>

  <div class="main">
    <div class="training-header">
      <span id="trainingTitle">üñ•Ô∏è VBMS Training Course</span>
      <button class="btn btn-outline-warning admin-toggle" id="adminToggle">Switch to Admin View</button>
    </div>

    <!-- ADMIN PANEL -->
    <div id="adminPanel" class="admin-panel" style="display:none;">
      <div class="row">
        <div class="col-md-6">
          <h5>Edit Course</h5>
          <input id="adminCourseTitle" class="form-control mb-2" placeholder="Course Title">
          <textarea id="adminCourseDesc" class="form-control mb-2" rows="2" placeholder="Description"></textarea>
          <button class="btn btn-sm btn-warning" onclick="saveCourse()">Save Course</button>
        </div>
        <div class="col-md-6">
          <h5>Add/Edit Lesson</h5>
          <input id="adminLessonTitle" class="form-control mb-2" placeholder="Lesson Title">
          <textarea id="adminLessonDesc" class="form-control mb-2" rows="2" placeholder="Lesson Description"></textarea>
          <input id="adminLessonVideo" class="form-control mb-2" placeholder="YouTube Link or .mp4 URL">
          <input type="file" id="adminLessonResource" class="form-control mb-2" accept="application/pdf,image/*">
          <input id="adminLessonQuiz" class="form-control mb-2" placeholder="Quiz Question (optional)">
          <input id="adminLessonQuizAnswer" class="form-control mb-2" placeholder="Quiz Answer (optional)">
          <button class="btn btn-sm btn-warning" onclick="addLesson()">Add/Update Lesson</button>
          <button class="btn btn-sm btn-secondary" onclick="clearLessonForm()">Clear</button>
        </div>
      </div>
      <div class="mt-3">
        <h6>Lessons (click to edit):</h6>
        <div id="adminLessons"></div>
      </div>
      <div class="mt-3">
        <button class="btn btn-danger btn-sm" onclick="deleteLesson()">Delete Selected Lesson</button>
        <button class="btn btn-success btn-sm" onclick="saveAllData()">Save All</button>
        <button class="btn btn-info btn-sm" onclick="showAnalytics()">Show Analytics</button>
        <button class="btn btn-dark btn-sm" onclick="employeePreview()">Employee Preview</button>
      </div>
      <div id="analyticsBox" style="margin-top:18px; display:none;"></div>
    </div>

    <!-- LESSONS/EMPLOYEE VIEW -->
    <div class="row">
      <div class="col-md-4">
        <div class="lesson-list mb-4">
          <div id="lessonList"></div>
          <div class="mt-3">
            <div>Progress: <span id="progressVal">0%</span></div>
            <div class="progress">
              <div class="progress-bar" id="progressBar" style="width:0%"></div>
            </div>
          </div>
        </div>
      </div>
      <div class="col-md-8" id="lessonArea">
        <!-- Populated by JS -->
      </div>
    </div>
  </div>
<script>
let isAdmin = false;
let selectedLesson = 0;
// Simulated localStorage db:
let db = JSON.parse(localStorage.getItem('vbms_training_data')) || {
  title: "VBMS Training Course",
  desc: "Complete all lessons to get your certificate.",
  lessons: [
    {
      title: "The Brain Science Behind Video Learning",
      desc: "Intro to video learning science.",
      video: "https://www.youtube.com/embed/VYOjWnS4cMY",
      resource: "",
      resourceName: "",
      quiz: "",
      quizAnswer: "",
      complete: false,
      watched: false,
      note: "",
      quizPassed: false
    },
    {
      title: "Real Media and Research",
      desc: "Evidence and best practices.",
      video: "",
      resource: "",
      resourceName: "",
      quiz: "What is one benefit of video learning?",
      quizAnswer: "Retention",
      complete: false,
      watched: false,
      note: "",
      quizPassed: false
    }
  ],
  analytics: {}
};
// Save to localStorage
function saveAllData(){
  localStorage.setItem('vbms_training_data',JSON.stringify(db));
  alert("Training data saved!");
  render();
}
function percentComplete(){
  return Math.round(100*db.lessons.filter(l=>l.complete).length/db.lessons.length);
}
function renderLessonList(){
  let list = '';
  db.lessons.forEach((l,i)=>{
    list+=`
      <div class="lesson-row${selectedLesson===i?' active':''}" onclick="selectLesson(${i})">
        <i class="bi bi-play-circle"></i>
        ${i+1}. ${l.title}
        ${l.complete?'<span class="lesson-complete-badge"><i class="bi bi-check-circle"></i> Complete</span>':''}
      </div>`;
  });
  document.getElementById('lessonList').innerHTML = list;
  document.getElementById('progressVal').innerText = percentComplete()+"%";
  document.getElementById('progressBar').style.width = percentComplete()+"%";
}
function renderLesson(){
  let l = db.lessons[selectedLesson];
  let html = `<h4>${l.title}</h4><div class="mb-2">${l.desc||''}</div>`;
  // VIDEO
  if(l.video){
    let yt = l.video.includes("youtube")||l.video.includes("youtu.be");
    html+= yt
      ? `<div class="ratio ratio-16x9 mb-3"><iframe src="${l.video}" allow="autoplay; encrypted-media" allowfullscreen id="lessonVideo"></iframe></div>`
      : `<video src="${l.video}" controls class="w-100 mb-3" id="lessonVideo"></video>`;
  } else {
    html+=`<div class="alert alert-warning">No video for this lesson.</div>`;
  }
  // Resource
  if(l.resource){
    let ext = l.resourceName.split('.').pop();
    let icon = ext==='pdf' ? 'bi-file-earmark-pdf-fill' : 'bi-image-fill';
    html += `<div class="mb-2"><i class="bi ${icon}"></i> 
      <a href="${l.resource}" class="resource-link" target="_blank">${l.resourceName}</a></div>`;
  }
  // QUIZ
  if(l.quiz){
    html+=`<div class="quiz-box">
      <b>Quiz:</b> ${l.quiz}<br>
      <input class="form-control form-control-sm mt-2 mb-2" id="quizAnswer" placeholder="Type your answer">
      <button class="btn btn-sm btn-warning" onclick="submitQuiz()">Submit Answer</button>
      <span id="quizResult"></span>
    </div>`;
  }
  // Notes
  html+=`<div class="mt-3 mb-2">
    <b>My Notes:</b>
    <textarea class="note-area w-100 mt-1" rows="2" onchange="saveNote(this.value)">${l.note||''}</textarea>
  </div>`;
  // Actions
  let canMarkComplete = false;
  let videoReady = false;
  let isWatched = l.watched || !l.video;
  // Listen for video end event to unlock
  setTimeout(()=>{
    let v = document.getElementById('lessonVideo');
    if(v){
      if(v.tagName==="IFRAME"){
        // YT API not loaded for security, so simulate watched after 10 sec for demo
        v.onload = ()=>{ setTimeout(()=>{ l.watched=true; },10000);}
      } else {
        v.onended = ()=>{ l.watched=true; renderLesson(); }
      }
    }
  },500);
  // Show Complete/Next logic
  if(l.quiz){
    canMarkComplete = l.quizPassed && isWatched;
  } else {
    canMarkComplete = isWatched;
  }
  html+=`<div class="mt-3">`;
  if(!l.complete){
    html += `<button class="btn btn-success me-2" ${canMarkComplete?'':'disabled'} onclick="markComplete()">Mark Complete</button>`;
  }
  if(selectedLesson<db.lessons.length-1){
    html += `<button class="btn btn-warning" ${l.complete?'':'disabled'} onclick="nextLesson()">Next <i class="bi bi-arrow-right"></i></button>`;
  }else if(percentComplete()===100){
    html+=`<div class="cert mt-4">
      <h2>üéâ Certificate of Completion</h2>
      <div>This certifies you completed all lessons.<br>
        <b>${db.title}</b>
        <br><br>
        <button class="btn btn-warning" onclick="downloadCert()">Download Certificate</button>
      </div>
    </div>`;
  }
  html+="</div>";
  document.getElementById('lessonArea').innerHTML = html;
}
function selectLesson(i){ selectedLesson = i; renderLessonList(); renderLesson(); }
function nextLesson(){ if(selectedLesson<db.lessons.length-1){ selectedLesson++; renderLessonList(); renderLesson();} }
function markComplete(){ db.lessons[selectedLesson].complete=true; saveAllData(); renderLessonList(); renderLesson(); }
function submitQuiz(){
  let ans = document.getElementById('quizAnswer').value.trim().toLowerCase();
  let l = db.lessons[selectedLesson];
  if(ans===l.quizAnswer.toLowerCase()){
    l.quizPassed=true;
    document.getElementById('quizResult').innerHTML = "<span class='text-success ms-2'><i class='bi bi-check-circle'></i> Correct!</span>";
  } else {
    l.quizPassed=false;
    document.getElementById('quizResult').innerHTML = "<span class='text-danger ms-2'><i class='bi bi-x-circle'></i> Try again!</span>";
  }
  saveAllData(); renderLesson();
}
function saveNote(val){ db.lessons[selectedLesson].note=val; saveAllData(); }
function downloadCert(){
  let cert = `
    Certificate of Completion

    Awarded to: [Your Name]
    Course: ${db.title}
    Date: ${new Date().toLocaleDateString()}

    Congratulations!
  `;
  let a = document.createElement('a');
  a.href = 'data:text/plain;charset=utf-8,' + encodeURIComponent(cert);
  a.download = "certificate.txt";
  a.click();
}

// ADMIN functions
function showAdmin(){
  isAdmin=true;
  document.getElementById('adminPanel').style.display = '';
  document.getElementById('adminToggle').innerText = "Switch to Employee View";
  render();
}
function hideAdmin(){
  isAdmin=false;
  document.getElementById('adminPanel').style.display = 'none';
  document.getElementById('adminToggle').innerText = "Switch to Admin View";
  render();
}
document.getElementById('adminToggle').onclick = function(){
  isAdmin ? hideAdmin() : showAdmin();
}
function saveCourse(){
  db.title = document.getElementById('adminCourseTitle').value;
  db.desc  = document.getElementById('adminCourseDesc').value;
  render();
}
function addLesson(){
  let title = document.getElementById('adminLessonTitle').value;
  let desc  = document.getElementById('adminLessonDesc').value;
  let video = document.getElementById('adminLessonVideo').value;
  let quiz  = document.getElementById('adminLessonQuiz').value;
  let quizA = document.getElementById('adminLessonQuizAnswer').value;
  let fileInput = document.getElementById('adminLessonResource');
  let lesson = {
    title, desc, video, resource:"", resourceName:"", quiz, quizAnswer:quizA, complete:false, watched:false, note:"", quizPassed:false
  };
  if(fileInput.files.length){
    let f = fileInput.files[0];
    let reader = new FileReader();
    reader.onload = function(e){
      lesson.resource = e.target.result;
      lesson.resourceName = f.name;
      db.lessons.push(lesson);
      clearLessonForm();
      render();
    };
    if(f.type.startsWith("image/") || f.type==="application/pdf")
      reader.readAsDataURL(f);
    else alert("Only image or PDF");
    return;
  }
  db.lessons.push(lesson);
  clearLessonForm();
  render();
}
function clearLessonForm(){
  ['adminLessonTitle','adminLessonDesc','adminLessonVideo','adminLessonQuiz','adminLessonQuizAnswer','adminLessonResource'].forEach(id=>document.getElementById(id).value="");
}
function renderAdminLessons(){
  let html = '';
  db.lessons.forEach((l,i)=>{
    html+=`<div class="lesson-row${selectedLesson===i?' active':''}" onclick="editLesson(${i})">
      <i class="bi bi-journal-text"></i> ${i+1}. ${l.title} ${l.complete?'<i class="bi bi-check2-circle text-success"></i>':''}
    </div>`;
  });
  document.getElementById('adminLessons').innerHTML = html;
}
function editLesson(i){
  selectedLesson = i;
  let l = db.lessons[i];
  document.getElementById('adminLessonTitle').value = l.title;
  document.getElementById('adminLessonDesc').value = l.desc;
  document.getElementById('adminLessonVideo').value = l.video;
  document.getElementById('adminLessonQuiz').value = l.quiz;
  document.getElementById('adminLessonQuizAnswer').value = l.quizAnswer;
  // can't auto fill resource for security reasons
}
function deleteLesson(){
  if(confirm("Delete this lesson?")){
    db.lessons.splice(selectedLesson,1);
    selectedLesson = 0;
    render();
  }
}
function showAnalytics(){
  let html = `<h5>Employee Progress</h5>`;
  db.lessons.forEach((l,i)=>{
    html+=`${i+1}. ${l.title}: ${l.complete?"‚úÖ":"‚ùå"}<br>`;
  });
  html+=`<br>Completed: ${percentComplete()}%`;
  document.getElementById('analyticsBox').innerHTML = html;
  document.getElementById('analyticsBox').style.display="";
}
function employeePreview(){
  hideAdmin();
  alert("Now viewing as employee.");
}
// RENDER
function render(){
  // Admin bar
  document.getElementById('trainingTitle').innerText = (db.title||"VBMS Training Course");
  if(isAdmin){
    document.getElementById('adminCourseTitle').value = db.title;
    document.getElementById('adminCourseDesc').value = db.desc;
    renderAdminLessons();
    document.getElementById('analyticsBox').style.display="none";
  }
  renderLessonList();
  renderLesson();
}
window.onload = render;
</script>
</body>
</html>
