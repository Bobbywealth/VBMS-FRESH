<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>VBMS | Staff Management</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />
  <link rel="stylesheet" href="https://unpkg.com/bootstrap-icons@1.11.3/font/bootstrap-icons.css">
  <style>
    body { background: #000; color: #fff; font-family: 'Inter', sans-serif; }
    .sidebar {
      position: fixed;
      top: 0;
      left: 0;
      width: 280px;
      height: 100vh;
      background: linear-gradient(180deg, #1a1a1a 0%, #111 100%);
      backdrop-filter: blur(12px);
      border-right: 1px solid #333;
      padding: 1.5rem 1rem;
      display: flex;
      flex-direction: column;
      z-index: 100;
      overflow-y: auto;
    }

    .logo {
      text-align: center;
      margin-bottom: 2rem;
    }

    .logo img {
      width: 120px;
      height: auto;
      filter: drop-shadow(0 0 10px #f0b90b66);
      animation: float 3s ease-in-out infinite;
    }

    @keyframes float {
      0%, 100% { transform: translateY(0px) rotate(0deg); }
      50% { transform: translateY(-5px) rotate(1deg); }
    }

    .sidebar-heading {
      color: #888;
      font-size: 0.72rem;
      margin: 0.8rem 0 0.4rem 0.4rem;
      text-transform: uppercase;
      font-weight: 600;
      letter-spacing: 1px;
    }

    .sidebar-link {
      color: #bbb;
      padding: 12px 20px;
      border-radius: 8px;
      display: flex;
      align-items: center;
      margin-bottom: 8px;
      text-decoration: none;
      font-weight: 500;
      transition: all 0.2s ease;
      position: relative;
      overflow: hidden;
    }

    .sidebar-link i {
      margin-right: 10px;
      font-size: 1.15rem;
      width: 20px;
      text-align: center;
    }

    .sidebar-link:hover, .sidebar-link.active {
      background: #f0b90b;
      color: #000 !important;
      font-weight: 700;
    }

    .btn-logout {
      margin-top: auto;
      width: 100%;
      background: #FFD600;
      border: none;
      color: #000;
      font-weight: 600;
      border-radius: 8px;
      padding: 0.75rem 1rem;
      transition: all 0.2s ease;
    }

    .btn-logout:hover {
      background: #e6c200;
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(255, 214, 0, 0.3);
    }
    .main-content { margin-left: 280px; padding: 2rem 2.5rem; flex-grow: 1; }
    footer { text-align: center; color: #888; margin-top: 2rem; font-size: 0.85rem; }
    .form-control, .form-select { background-color: #222 !important; color: #fff !important; border: 1px solid #f0b90b !important; }
    .form-control::placeholder, .form-select option { color: #ccc !important; }
    .form-control:focus, .form-select:focus { background-color: #333 !important; color: #fff !important; border-color: #f0b90b !important; box-shadow: 0 0 5px #f0b90b; }
    .table-responsive { max-height: 400px; overflow-y: auto; }
    .table { font-size: 0.9rem; }
    .table th { background-color: #222; color: #f0b90b; border-color: #555; }
    .table td { border-color: #444; }
    .table-hover tbody tr:hover { background-color: #222; }
  </style>
</head>
<body>
  <div class="d-flex">
    <!-- Sidebar -->
    <nav class="sidebar">
      <div class="logo">
        <img src="https://iili.io/F7bM6Jt.md.png" alt="VBMS" />
      </div>
      
      <p class="sidebar-heading">CORE</p>
      <a class="sidebar-link" href="dashboard.html" aria-label="Dashboard"><i class="bi bi-speedometer2"></i><span>Dashboard</span></a>
      <a class="sidebar-link" href="reports.html" aria-label="Reports"><i class="bi bi-bar-chart-line"></i><span>Reports</span></a>
      
      <p class="sidebar-heading">OPERATIONS</p>
      <a class="sidebar-link" href="orders.html" aria-label="Orders"><i class="bi bi-box"></i><span>Orders</span></a>
      <a class="sidebar-link" href="monitoring.html" aria-label="Monitoring"><i class="bi bi-camera-video"></i><span>Monitoring</span></a>
      <a class="sidebar-link" href="inventory.html" aria-label="Inventory"><i class="bi bi-stack"></i><span>Inventory</span></a>
      <a class="sidebar-link" href="calendar.html" aria-label="Calendar"><i class="bi bi-calendar-event"></i><span>Calendar</span></a>
      
      <p class="sidebar-heading">PEOPLE & CLIENTS</p>
      <a class="sidebar-link active" href="team.html" aria-label="Team"><i class="bi bi-people"></i><span>Team</span></a>
      <a class="sidebar-link" href="clients.html" aria-label="Clients"><i class="bi bi-person-badge"></i><span>Clients</span></a>
      <a class="sidebar-link" href="leads.html" aria-label="Leads"><i class="bi bi-person-lines-fill"></i><span>Leads</span></a>
      
      <p class="sidebar-heading">TASKS & COMMUNICATION</p>
      <a class="sidebar-link" href="task-board.html" aria-label="Task Manager"><i class="bi bi-kanban"></i><span>Task Manager</span></a>
      <a class="sidebar-link" href="messaging.html" aria-label="Messaging"><i class="bi bi-chat-dots"></i><span>Messaging</span></a>
      
      <p class="sidebar-heading">AI TOOLS</p>
      <a class="sidebar-link" href="Aiphone.html" aria-label="AI Phone"><i class="bi bi-telephone"></i><span>AI Phone</span></a>
      <a class="sidebar-link" href="Aiassistant.html" aria-label="AI Assistant"><i class="bi bi-robot"></i><span>AI Assistant</span></a>
      
      <p class="sidebar-heading">BUSINESS TOOLS</p>
      <a class="sidebar-link" href="billing.html" aria-label="Billing"><i class="bi bi-credit-card-2-front"></i><span>Billing</span></a>
      <a class="sidebar-link" href="settings.html" aria-label="Settings"><i class="bi bi-gear"></i><span>Settings</span></a>
      <a class="sidebar-link" href="training.html" aria-label="Training"><i class="bi bi-mortarboard"></i><span>Training</span></a>
      
      <p class="sidebar-heading">DEV/UTILITY</p>
      <a class="sidebar-link" href="wizard.html" aria-label="Wizard (Dev)"><i class="bi bi-tools"></i><span>Wizard (Dev)</span></a>
      <a class="sidebar-link" href="wizard-step2.html" aria-label="Wizard Step 2"><i class="bi bi-tools"></i><span>Wizard Step 2</span></a>
      <a class="sidebar-link" href="wizard-step3.html" aria-label="Wizard Step 3"><i class="bi bi-tools"></i><span>Wizard Step 3</span></a>
      
      <button class="btn btn-warning btn-logout" onclick="logout()"><i class="bi bi-box-arrow-left"></i> Logout</button>
    </nav>

    <!-- Main Content -->
    <main class="main-content w-100">
      <div class="d-flex justify-content-between align-items-center mb-3">
        <h3 class="text-warning"><i class="bi bi-people-fill"></i> Staff Management</h3>
        <div class="dropdown">
          <button class="btn btn-outline-light dropdown-toggle" data-bs-toggle="dropdown">
            <i class="bi bi-person-fill text-primary"></i> Sarah (Virtual Manager)
          </button>
          <ul class="dropdown-menu dropdown-menu-end">
            <li><a class="dropdown-item" href="#">ðŸ‘¤ Profile</a></li>
            <li><a class="dropdown-item text-danger" href="#" onclick="logout()">ðŸšª Logout</a></li>
          </ul>
        </div>
      </div>

      <div class="d-flex mb-3 gap-2">
        <input type="text" class="form-control" id="searchInput" placeholder="Search staff..." />
        <button class="btn btn-warning" data-bs-toggle="modal" data-bs-target="#teamModal">
          <i class="bi bi-plus-circle"></i> Add Staff
        </button>
      </div>

      <!-- Invite New User Form -->
      <form id="inviteForm" class="mb-4 bg-dark p-4 rounded border border-warning">
        <h4 class="text-warning mb-3"><i class="bi bi-person-plus-fill"></i> Add New Staff Member</h4>
        <div class="row g-2">
          <div class="col-md-4">
            <input type="text" id="invite-name" class="form-control" placeholder="Full Name" required />
          </div>
          <div class="col-md-4">
            <input type="email" id="invite-email" class="form-control" placeholder="Email Address" required />
          </div>
          <div class="col-md-3">
            <input type="password" id="invite-pass" class="form-control" placeholder="Password" required />
          </div>
          <div class="col-md-1">
            <select id="invite-role" class="form-select">
              <option value="staff">Staff</option>
              <option value="manager">Manager</option>
              <option value="supervisor">Supervisor</option>
              <option value="support">Support</option>
            </select>
          </div>
        </div>
        <button type="submit" class="btn btn-warning mt-3">Add Staff Member</button>
        <div id="invite-feedback" class="mt-2"></div>
      </form>

      <!-- Team Table -->
      <div class="table-responsive">
        <table class="table table-dark table-bordered table-hover">
          <thead class="bg-secondary text-warning">
            <tr>
              <th>Name</th>
              <th>Position</th>
              <th>Role</th>
              <th>Status</th>
              <th>Action</th>
            </tr>
          </thead>
          <tbody id="teamBody"></tbody>
        </table>
      </div>

      <footer>&copy; 2025 VBMS. All rights reserved.</footer>
    </main>
  </div>

  <!-- Modal: Add/Edit Member -->
  <div class="modal fade" id="teamModal" tabindex="-1">
    <div class="modal-dialog modal-dialog-centered">
      <form id="teamMemberForm" class="modal-content bg-dark text-white">
        <div class="modal-header">
          <h5 class="modal-title text-warning">Add/Edit Staff Member</h5>
          <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
        </div>
        <div class="modal-body row g-3">
          <div class="col-md-6">
            <input type="text" id="memberName" class="form-control" placeholder="Full Name" required />
          </div>
          <div class="col-md-6">
            <input type="email" id="memberEmail" class="form-control" placeholder="Email" required />
          </div>
          <div class="col-md-6">
            <input type="password" id="memberPassword" class="form-control" placeholder="Password (leave blank to keep)" />
          </div>
          <div class="col-md-6">
            <input type="text" id="memberPosition" class="form-control" placeholder="Position" />
          </div>
          <div class="col-md-6">
            <select id="memberRole" class="form-select">
              <option value="Staff">Staff</option>
              <option value="Manager">Manager</option>
              <option value="Supervisor">Supervisor</option>
              <option value="Support">Support</option>
            </select>
          </div>
          <div class="col-md-6">
            <select id="memberStatus" class="form-select">
              <option value="Active">Active</option>
              <option value="Inactive">Inactive</option>
            </select>
          </div>
        </div>
        <div class="modal-footer">
          <button type="submit" class="btn btn-warning">Save</button>
          <button type="button" class="btn btn-outline-light" data-bs-dismiss="modal">Cancel</button>
        </div>
      </form>
    </div>
  </div>

  <script>
    (function() {
      const API_BASE = window.location.hostname === 'localhost'
        ? 'http://localhost:5050'
        : 'https://vbms-backend.onrender.com';
      const TOKEN_KEY = 'vbmsToken';

      // Invite new user
      document.getElementById('inviteForm').addEventListener('submit', async e => {
        e.preventDefault();
        const fb = document.getElementById('invite-feedback');
        fb.textContent = '';
        fb.className = '';

        const name = document.getElementById('invite-name').value.trim();
        const email = document.getElementById('invite-email').value.trim();
        const password = document.getElementById('invite-pass').value;
        const role = document.getElementById('invite-role').value;

        try {
          const token = localStorage.getItem(TOKEN_KEY);
          if (!token) throw new Error('You must be logged in as admin.');

          const res = await fetch(`${API_BASE}/api/admin/create-user`, {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json',
              'Authorization': `Bearer ${token}`
            },
            body: JSON.stringify({ name, email, password, role })
          });
          const contentType = res.headers.get('content-type') || '';
          if (!res.ok || !contentType.includes('application/json')) {
            const text = await res.text();
            throw new Error(text || `Error ${res.status}`);
          }
          const data = await res.json();
          fb.className = 'text-success';
          fb.textContent = data.message || 'User created!';
          e.target.reset();
        } catch (err) {
          fb.className = 'text-danger';
          fb.textContent = err.message;
        }
      });

      // Team list & edit/delete
      let users = [];
      let editingUserId = null;

      function getRoleColor(role) {
        switch (role) {
          case 'Manager': return 'primary';
          case 'Supervisor': return 'info';
          case 'Support': return 'warning';
          case 'Staff': return 'secondary';
          default: return 'light';
        }
      }

      async function fetchTeam(filter = '') {
        const token = localStorage.getItem(TOKEN_KEY);
        const res = await fetch(`${API_BASE}/api/users`, {
          headers: token ? { 'Authorization': `Bearer ${token}` } : {}
        });
        users = await res.json();
        renderTeam(users, filter);
      }

      function renderTeam(arr, filter) {
        const tbody = document.getElementById('teamBody');
        tbody.innerHTML = '';
        arr.filter(u => u.name.toLowerCase().includes(filter.toLowerCase()))
          .forEach(u => {
            tbody.innerHTML += `
              <tr>
                <td>${u.name}</td>
                <td>${u.position || ''}</td>
                <td><span class="badge bg-${getRoleColor(u.role)}">${u.role}</span></td>
                <td><span class="badge bg-${u.status === 'Active'? 'success':'danger'}">${u.status || 'Active'}</span></td>
                <td>
                  <button class="btn btn-sm btn-warning me-1" onclick="editMember('${u._id}')"><i class="bi bi-pencil"></i></button>
                  <button class="btn btn-sm btn-outline-danger" onclick="deleteMember('${u._id}')"><i class="bi bi-trash"></i></button>
                </td>
              </tr>`;
          });
      }

      document.getElementById('teamMemberForm').addEventListener('submit', async e => {
        e.preventDefault();
        const token = localStorage.getItem(TOKEN_KEY);
        const data = {
          name: document.getElementById('memberName').value,
          email: document.getElementById('memberEmail').value,
          position: document.getElementById('memberPosition').value,
          role: document.getElementById('memberRole').value,
          status: document.getElementById('memberStatus').value
        };
        const pwd = document.getElementById('memberPassword').value;
        if (pwd) data.password = pwd;

        const url = editingUserId
          ? `${API_BASE}/api/users/${editingUserId}`
          : `${API_BASE}/api/users`;
        const method = editingUserId ? 'PUT' : 'POST';

        await fetch(url, {
          method,
          headers: {
            'Content-Type': 'application/json',
            'Authorization': `Bearer ${token}`
          },
          body: JSON.stringify(data)
        });

        editingUserId = null;
        bootstrap.Modal.getInstance(document.getElementById('teamModal')).hide();
        e.target.reset();
        fetchTeam();
      });

      window.editMember = id => {
        const u = users.find(x => x._id === id);
        document.getElementById('memberName').value = u.name;
        document.getElementById('memberEmail').value = u.email;
        document.getElementById('memberPosition').value = u.position || '';
        document.getElementById('memberRole').value = u.role;
        document.getElementById('memberStatus').value = u.status || 'Active';
        document.getElementById('memberPassword').value = '';
        editingUserId = id;
        new bootstrap.Modal(document.getElementById('teamModal')).show();
      };

      window.deleteMember = async id => {
        if (!confirm('Confirm delete?')) return;
        const token = localStorage.getItem(TOKEN_KEY);
        await fetch(`${API_BASE}/api/users/${id}`, { method: 'DELETE', headers: { 'Authorization': `Bearer ${token}` } });
        fetchTeam();
      };

      document.getElementById('searchInput').addEventListener('input', e =>
        fetchTeam(e.target.value)
      );

      window.logout = () => {
        localStorage.removeItem(TOKEN_KEY);
        window.location.href = 'login.html';
      };

      document.addEventListener('DOMContentLoaded', () => fetchTeam());
    })();

    // Mobile sidebar toggle
    function toggleSidebar() {
      const sidebar = document.querySelector('.sidebar');
      if (sidebar) {
        sidebar.classList.toggle('open');
      }
    }
  </script>
</body>
</html>cript>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
