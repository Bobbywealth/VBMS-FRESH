<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Advanced Analytics - Master Admin - VBMS</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet">
  <style>
        :root {
            --accent: #f0b90b;
            --accent-light: #ffd700;
            --accent-glow: rgba(240, 185, 11, 0.4);
            --primary-dark: #d4a109;
            --secondary: #2c3e50;
            --success: #22c55e;
            --danger: #ef4444;
            --warning: #f59e0b;
            --info: #3b82f6;
            --purple: #a855f7;
            --cyan: #06b6d4;
            --light: #f8f9fa;
            --dark: #212529;
            --glass: rgba(255,255,255,0.95);
            --glass-glow: rgba(240, 185, 11, 0.15);
            --border: #e9ecef;
            --text: #212529;
            --text-muted: #6c757d;
            --card-bg: #ffffff;
            --card-shadow: 0 8px 32px rgba(240, 185, 11, 0.1);
            --bg: linear-gradient(135deg, #f8f9fa 0%, #f0f8ff 50%, #f8f4ff 100%);
            --sidebar-bg: rgba(255,255,255,0.98);
            --sidebar-link: #333;
            --sidebar-link-active: #000;
            --master-admin-glow: rgba(255, 0, 0, 0.2);
            --master-admin-accent: #dc3545;
        }

        /* Dark theme - Modern Black/Gray with Energy */
        [data-theme="dark"] {
            --bg: linear-gradient(135deg, #000000 0%, #0a0a0a 25%, #1a1a1a 50%, #0f0f0f 100%);
            --light: #ffffff;
            --dark: #000000;
            --text: #ffffff;
            --text-muted: #a1a1aa;
            --card-bg: rgba(20, 20, 20, 0.95);
            --card-shadow: 0 8px 32px rgba(0, 0, 0, 0.8), 0 0 20px rgba(240, 185, 11, 0.15);
            --border: rgba(64, 64, 64, 0.4);
            --glass: rgba(18, 18, 18, 0.95);
            --glass-glow: rgba(240, 185, 11, 0.2);
            --sidebar-bg: rgba(12, 12, 12, 0.98);
            --sidebar-link: #d4d4d8;
            --sidebar-link-active: #ffffff;
            --accent: #f0b90b;
            --accent-light: #ffd700;
            --success: #22c55e;
            --danger: #ef4444;
            --warning: #f59e0b;
            --info: #3b82f6;
            --purple: #a855f7;
            --cyan: #06b6d4;
            --master-admin-glow: rgba(220, 53, 69, 0.3);
            --master-admin-accent: #dc3545;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Segoe UI', sans-serif;
            background: var(--bg);
            color: var(--text);
            overflow-x: hidden;
            transition: all 0.3s ease;
            position: relative;
            min-height: 100vh;
        }

        /* Enhanced Background Animation */
        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -2;
            background: 
                radial-gradient(circle at 20% 30%, rgba(240, 185, 11, 0.08) 0%, transparent 50%),
                radial-gradient(circle at 80% 70%, rgba(59, 130, 246, 0.05) 0%, transparent 50%),
                radial-gradient(circle at 50% 50%, rgba(168, 85, 247, 0.03) 0%, transparent 60%);
            animation: enhancedGlow 25s ease-in-out infinite;
        }

        [data-theme="dark"] body::before {
            background: 
                radial-gradient(circle at 15% 25%, rgba(240, 185, 11, 0.08) 0%, transparent 50%),
                radial-gradient(circle at 85% 75%, rgba(128, 128, 128, 0.06) 0%, transparent 60%),
                radial-gradient(circle at 50% 50%, rgba(64, 64, 64, 0.05) 0%, transparent 70%);
            animation: darkThemeGlow 25s ease-in-out infinite;
        }

        @keyframes enhancedGlow {
            0%, 100% { opacity: 0.6; transform: rotate(0deg) scale(1); }
            33% { opacity: 0.8; transform: rotate(120deg) scale(1.05); }
            66% { opacity: 0.7; transform: rotate(240deg) scale(0.95); }
        }

        @keyframes darkThemeGlow {
            0%, 100% { opacity: 0.8; transform: rotate(0deg) scale(1); }
            25% { opacity: 1; transform: rotate(90deg) scale(1.1); }
            50% { opacity: 0.9; transform: rotate(180deg) scale(1.05); }
            75% { opacity: 1; transform: rotate(270deg) scale(1.08); }
        }

        .main-content {
            margin-left: 320px;
            padding: 30px;
            min-height: 100vh;
            background: transparent;
            transition: all 0.3s ease;
        }

        /* Mobile content adjustments */
        @media (max-width: 1024px) {
            .main-content { margin-left: 280px; padding: 25px; }
        }

        @media (max-width: 768px) {
            .main-content { margin-left: 0; padding: 80px 15px 15px 15px; }
        }

        /* Header Styling */
        .header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 30px;
            padding: 20px 0;
        }

        .header-left h1 {
            font-size: 2.5rem;
            font-weight: 700;
            color: var(--text);
            margin: 0 0 10px 0;
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .header-left h1 i {
            color: var(--master-admin-accent);
            font-size: 2rem;
        }

        .header-right {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        /* Theme Toggle */
        .btn-outline-warning {
            background: var(--glass);
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 12px;
            color: var(--accent);
            transition: all 0.3s ease;
        }

        .btn-outline-warning:hover {
            background: var(--glass-glow);
            border-color: var(--accent);
            color: var(--accent);
            transform: translateY(-2px);
        }

        /* Master Admin Badge */
        .master-admin-badge {
            background: linear-gradient(135deg, var(--master-admin-accent), var(--danger));
            color: white;
            padding: 8px 15px;
            border-radius: 25px;
            font-size: 0.8rem;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 15px;
            box-shadow: 0 4px 15px var(--master-admin-glow);
        }

        /* Analytics Grid */
        .analytics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 25px;
            margin-bottom: 30px;
        }

        /* Analytics Card */
        .analytics-card {
            background: var(--glass);
            backdrop-filter: blur(15px);
            padding: 25px;
            border-radius: 20px;
            border: 1px solid var(--border);
            box-shadow: var(--card-shadow);
            transition: all 0.4s ease;
            position: relative;
            overflow: hidden;
        }

        .analytics-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, var(--accent), var(--accent-light));
            opacity: 0.8;
        }

        .analytics-card.master-admin-card::before {
            background: linear-gradient(90deg, var(--master-admin-accent), var(--danger));
        }

        .analytics-card.revenue-card::before {
            background: linear-gradient(90deg, var(--success), #10b981);
        }

        .analytics-card.user-card::before {
            background: linear-gradient(90deg, var(--info), var(--cyan));
        }

        .analytics-card.performance-card::before {
            background: linear-gradient(90deg, var(--purple), var(--warning));
        }

        .analytics-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 40px rgba(240, 185, 11, 0.2);
            border-color: var(--accent);
        }

        .analytics-card.master-admin-card:hover {
            box-shadow: 0 15px 40px var(--master-admin-glow);
            border-color: var(--master-admin-accent);
        }

        .analytics-card h4 {
            color: var(--accent);
            font-size: 1.3rem;
            font-weight: 700;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .analytics-card.master-admin-card h4 {
            color: var(--master-admin-accent);
        }

        .analytics-card.revenue-card h4 {
            color: var(--success);
        }

        .analytics-card.user-card h4 {
            color: var(--info);
        }

        .analytics-card.performance-card h4 {
            color: var(--purple);
        }

        /* KPI Cards */
        .kpi-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .kpi-card {
            background: var(--glass);
            backdrop-filter: blur(15px);
            padding: 20px;
            border-radius: 15px;
            border: 1px solid var(--border);
            text-align: center;
            transition: all 0.3s ease;
        }

        .kpi-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 30px rgba(240, 185, 11, 0.2);
        }

        .kpi-value {
            font-size: 2rem;
            font-weight: 700;
            color: var(--text);
            margin-bottom: 5px;
        }

        .kpi-label {
            color: var(--text-muted);
            font-size: 0.9rem;
            font-weight: 500;
            margin-bottom: 10px;
        }

        .kpi-trend {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 5px;
            font-size: 0.85rem;
            font-weight: 600;
        }

        .trend-up { color: var(--success); }
        .trend-down { color: var(--danger); }
        .trend-stable { color: var(--info); }

        /* Chart Containers */
        .chart-container {
            background: var(--glass);
            border-radius: 15px;
            padding: 20px;
            height: 350px;
            display: flex;
            align-items: center;
            justify-content: center;
            border: 1px solid var(--border);
            position: relative;
            margin-bottom: 15px;
        }

        .chart-placeholder {
            color: var(--text-muted);
            text-align: center;
        }

        .chart-placeholder i {
            font-size: 4rem;
            margin-bottom: 15px;
            opacity: 0.6;
        }

        /* Advanced Filters */
        .filter-section {
            background: var(--glass);
            backdrop-filter: blur(15px);
            padding: 20px;
            border-radius: 15px;
            border: 1px solid var(--border);
            margin-bottom: 25px;
            display: flex;
            gap: 15px;
            align-items: center;
            flex-wrap: wrap;
        }

        .filter-section select,
        .filter-section input {
            background: var(--glass);
            border: 1px solid var(--border);
            border-radius: 8px;
            padding: 8px 12px;
            color: var(--text);
            min-width: 150px;
        }

        .filter-section select:focus,
        .filter-section input:focus {
            outline: none;
            border-color: var(--accent);
            box-shadow: 0 0 0 3px rgba(240, 185, 11, 0.1);
        }

        /* Action Buttons */
        .action-btn {
            background: var(--accent);
            color: #000;
            border: none;
            padding: 10px 20px;
            border-radius: 8px;
            font-weight: 600;
            margin-right: 10px;
            margin-bottom: 10px;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .action-btn:hover {
            background: var(--accent-light);
            transform: translateY(-1px);
            box-shadow: 0 4px 15px rgba(240, 185, 11, 0.3);
        }

        .action-btn.master-admin {
            background: var(--master-admin-accent);
            color: white;
        }

        .action-btn.master-admin:hover {
            background: var(--danger);
            box-shadow: 0 4px 15px var(--master-admin-glow);
        }

        /* Data Insights */
        .insight-card {
            background: var(--glass);
            padding: 20px;
            border-radius: 12px;
            border-left: 4px solid var(--accent);
            margin-bottom: 15px;
            transition: all 0.3s ease;
        }

        .insight-card:hover {
            transform: translateX(5px);
            box-shadow: 0 5px 20px rgba(240, 185, 11, 0.2);
        }

        .insight-card.critical {
            border-left-color: var(--master-admin-accent);
        }

        .insight-card.positive {
            border-left-color: var(--success);
        }

        .insight-card.warning {
            border-left-color: var(--warning);
        }

        .insight-title {
            font-weight: 700;
            color: var(--text);
            margin-bottom: 8px;
        }

        .insight-description {
            color: var(--text-muted);
            font-size: 0.9rem;
            line-height: 1.5;
        }

        /* Predictive Analytics */
        .prediction-card {
            background: linear-gradient(135deg, var(--glass), rgba(168, 85, 247, 0.05));
            border: 2px solid var(--purple);
            border-radius: 20px;
            padding: 25px;
            margin-bottom: 25px;
            position: relative;
            overflow: hidden;
        }

        .prediction-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, var(--purple), var(--cyan));
        }

        .prediction-card h4 {
            color: var(--purple);
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        /* Real-time Indicators */
        .realtime-indicator {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: 600;
            margin-bottom: 15px;
            background: rgba(34, 197, 94, 0.2);
            color: var(--success);
            border: 1px solid var(--success);
        }

        .realtime-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: currentColor;
            animation: realtimePulse 1.5s ease-in-out infinite;
        }

        @keyframes realtimePulse {
            0%, 100% { opacity: 1; transform: scale(1); }
            50% { opacity: 0.5; transform: scale(1.2); }
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .analytics-grid {
                grid-template-columns: 1fr;
            }
            
            .kpi-grid {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .filter-section {
                flex-direction: column;
                align-items: stretch;
            }
            
            .filter-section select,
            .filter-section input {
                min-width: auto;
            }
            
            .header-left h1 {
                font-size: 2rem;
            }

            .chart-container {
                height: 250px;
            }
        }

        /* Dark theme enhancements */
        [data-theme="dark"] .analytics-card,
        [data-theme="dark"] .filter-section,
        [data-theme="dark"] .kpi-card,
        [data-theme="dark"] .prediction-card {
            border: 1px solid rgba(64, 64, 64, 0.4);
            box-shadow: 
                0 8px 32px rgba(0, 0, 0, 0.8),
                0 0 20px rgba(240, 185, 11, 0.1);
        }

        [data-theme="dark"] .analytics-card:hover,
        [data-theme="dark"] .kpi-card:hover {
            box-shadow: 
                0 12px 40px rgba(0, 0, 0, 0.9),
                0 0 30px rgba(240, 185, 11, 0.2);
        }
  </style>
</head>
<body>
<!-- Master Admin Sidebar Container -->
<div id="master-admin-sidebar-container"></div>

<!-- MAIN -->
<main class="main-content">
  <!-- Header -->
  <div class="header">
    <div class="header-left">
      <div class="master-admin-badge">
        <i class="bi bi-crown-fill"></i> MASTER ADMIN ANALYTICS
      </div>
      <h1><i class="bi bi-graph-up-arrow"></i> Advanced System Analytics</h1>
    </div>
    <div class="header-right">
      <div class="realtime-indicator">
        <div class="realtime-dot"></div>
        <span>Real-time Data</span>
      </div>
      <button class="btn btn-outline-warning btn-sm" onclick="toggleTheme()" title="Toggle light/dark theme">
        <i id="themeIcon" class="bi bi-moon-fill"></i>
      </button>
    </div>
  </div>

  <!-- Advanced Filters -->
  <div class="filter-section">
    <select id="timeRange">
      <option value="realtime">Real-time</option>
      <option value="1h">Last Hour</option>
      <option value="24h" selected>Last 24 Hours</option>
      <option value="7d">Last 7 Days</option>
      <option value="30d">Last 30 Days</option>
      <option value="90d">Last 90 Days</option>
      <option value="1y">Last Year</option>
    </select>
    <select id="dataScope">
      <option value="all">All Data</option>
      <option value="customers">Customer Data</option>
      <option value="revenue">Revenue Data</option>
      <option value="system">System Metrics</option>
      <option value="performance">Performance Data</option>
    </select>
    <select id="analysisType">
      <option value="overview">Overview</option>
      <option value="detailed">Detailed Analysis</option>
      <option value="predictive">Predictive Analytics</option>
      <option value="comparative">Comparative Analysis</option>
    </select>
    <button class="action-btn master-admin" onclick="generateAdvancedAnalytics()">
      <i class="bi bi-cpu"></i> Generate AI Analysis
    </button>
    <button class="action-btn" onclick="exportAnalytics()">
      <i class="bi bi-download"></i> Export Data
    </button>
  </div>

  <!-- Key Performance Indicators -->
  <div class="kpi-grid">
    <div class="kpi-card">
      <div class="kpi-value" id="totalRevenue">$847,291</div>
      <div class="kpi-label">Total Revenue</div>
      <div class="kpi-trend trend-up">
        <i class="bi bi-arrow-up"></i>
        <span>+24.8%</span>
      </div>
    </div>

    <div class="kpi-card">
      <div class="kpi-value" id="activeUsers">12,847</div>
      <div class="kpi-label">Active Users</div>
      <div class="kpi-trend trend-up">
        <i class="bi bi-arrow-up"></i>
        <span>+18.2%</span>
      </div>
    </div>

    <div class="kpi-card">
      <div class="kpi-value" id="conversionRate">18.4%</div>
      <div class="kpi-label">Conversion Rate</div>
      <div class="kpi-trend trend-up">
        <i class="bi bi-arrow-up"></i>
        <span>+3.7%</span>
      </div>
    </div>

    <div class="kpi-card">
      <div class="kpi-value" id="systemUptime">99.97%</div>
      <div class="kpi-label">System Uptime</div>
      <div class="kpi-trend trend-stable">
        <i class="bi bi-dash"></i>
        <span>Stable</span>
      </div>
    </div>

    <div class="kpi-card">
      <div class="kpi-value" id="customerSat">4.8/5</div>
      <div class="kpi-label">Customer Satisfaction</div>
      <div class="kpi-trend trend-up">
        <i class="bi bi-arrow-up"></i>
        <span>+0.3</span>
      </div>
    </div>

    <div class="kpi-card">
      <div class="kpi-value" id="churnRate">2.1%</div>
      <div class="kpi-label">Churn Rate</div>
      <div class="kpi-trend trend-down">
        <i class="bi bi-arrow-down"></i>
        <span>-1.2%</span>
      </div>
    </div>
  </div>

  <!-- Predictive Analytics -->
  <div class="prediction-card">
    <h4><i class="bi bi-robot"></i> AI-Powered Predictions</h4>
    <div class="row">
      <div class="col-md-4">
        <div class="insight-title">Revenue Forecast (Next 30 Days)</div>
        <div class="insight-description">Based on current trends, projected revenue: <strong>$1.2M</strong> (+15% growth)</div>
      </div>
      <div class="col-md-4">
        <div class="insight-title">Customer Growth Prediction</div>
        <div class="insight-description">Expected new customers: <strong>+420</strong> (confidence: 87%)</div>
      </div>
      <div class="col-md-4">
        <div class="insight-title">System Load Forecast</div>
        <div class="insight-description">Peak usage expected: <strong>Thu 2-4 PM</strong> (prepare scaling)</div>
      </div>
    </div>
  </div>

  <!-- Analytics Grid -->
  <div class="analytics-grid">
    <!-- Revenue Analytics -->
    <div class="analytics-card revenue-card">
      <h4><i class="bi bi-cash-stack"></i> Revenue Analytics</h4>
      <div class="chart-container">
        <div class="chart-placeholder">
          <i class="bi bi-graph-up" style="color: var(--success);"></i>
          <h5>Revenue Trends</h5>
          <p>Real-time revenue tracking with predictive modeling</p>
          <small>Current MRR: $127,450 (+24.8% MoM)</small>
        </div>
      </div>
      <button class="action-btn" onclick="drillDownRevenue()">
        <i class="bi bi-zoom-in"></i> Drill Down
      </button>
    </div>

    <!-- User Behavior Analytics -->
    <div class="analytics-card user-card">
      <h4><i class="bi bi-people"></i> User Behavior Analytics</h4>
      <div class="chart-container">
        <div class="chart-placeholder">
          <i class="bi bi-activity" style="color: var(--info);"></i>
          <h5>User Engagement Patterns</h5>
          <p>Advanced user journey and behavior analysis</p>
          <small>Avg. Session: 12m 34s (+8.2%)</small>
        </div>
      </div>
      <button class="action-btn" onclick="analyzeUserBehavior()">
        <i class="bi bi-eye"></i> View Details
      </button>
    </div>

    <!-- System Performance -->
    <div class="analytics-card performance-card">
      <h4><i class="bi bi-speedometer2"></i> System Performance</h4>
      <div class="chart-container">
        <div class="chart-placeholder">
          <i class="bi bi-cpu" style="color: var(--purple);"></i>
          <h5>Performance Metrics</h5>
          <p>Real-time system health and performance monitoring</p>
          <small>Avg. Response Time: 1.2ms</small>
        </div>
      </div>
      <button class="action-btn" onclick="optimizePerformance()">
        <i class="bi bi-gear"></i> Optimize
      </button>
    </div>

    <!-- Master Admin Insights -->
    <div class="analytics-card master-admin-card">
      <h4><i class="bi bi-shield-lock"></i> Master Admin Insights</h4>
      <div class="chart-container">
        <div class="chart-placeholder">
          <i class="bi bi-graph-down-arrow" style="color: var(--master-admin-accent);"></i>
          <h5>System-Wide Analytics</h5>
          <p>Founder-level insights and system overview</p>
          <small>Total System Value: $2.4M</small>
        </div>
      </div>
      <button class="action-btn master-admin" onclick="masterAdminReport()">
        <i class="bi bi-crown"></i> Full Report
      </button>
    </div>

    <!-- Geographic Analytics -->
    <div class="analytics-card">
      <h4><i class="bi bi-globe"></i> Geographic Distribution</h4>
      <div class="chart-container">
        <div class="chart-placeholder">
          <i class="bi bi-map" style="color: var(--cyan);"></i>
          <h5>Global User Distribution</h5>
          <p>Customer geographic analysis and regional insights</p>
          <small>Top Region: North America (67%)</small>
        </div>
      </div>
      <button class="action-btn" onclick="viewGeoAnalytics()">
        <i class="bi bi-pin-map"></i> View Map
      </button>
    </div>

    <!-- Conversion Funnel -->
    <div class="analytics-card">
      <h4><i class="bi bi-funnel"></i> Conversion Funnel</h4>
      <div class="chart-container">
        <div class="chart-placeholder">
          <i class="bi bi-arrow-down-circle" style="color: var(--warning);"></i>
          <h5>Sales Funnel Analysis</h5>
          <p>Conversion rates and optimization opportunities</p>
          <small>Overall Conversion: 18.4%</small>
        </div>
      </div>
      <button class="action-btn" onclick="optimizeFunnel()">
        <i class="bi bi-arrow-up-right"></i> Optimize
      </button>
    </div>
  </div>

  <!-- Data Insights -->
  <div class="row">
    <div class="col-md-6">
      <div class="analytics-card">
        <h4><i class="bi bi-lightbulb"></i> Key Insights</h4>
        
        <div class="insight-card positive">
          <div class="insight-title">Revenue Growth Acceleration</div>
          <div class="insight-description">Monthly revenue growth has increased by 24.8%, significantly outperforming industry average of 12%.</div>
        </div>

        <div class="insight-card warning">
          <div class="insight-title">Customer Acquisition Cost Rising</div>
          <div class="insight-description">CAC has increased by 15% over the last quarter. Consider optimizing marketing channels.</div>
        </div>

        <div class="insight-card critical">
          <div class="insight-title">High-Value Customer Concentration</div>
          <div class="insight-description">80% of revenue comes from 20% of customers. Focus on retention strategies for top-tier clients.</div>
        </div>

        <div class="insight-card positive">
          <div class="insight-title">System Performance Excellence</div>
          <div class="insight-description">99.97% uptime achieved with 1.2ms average response time, exceeding all SLA targets.</div>
        </div>
      </div>
    </div>

    <div class="col-md-6">
      <div class="analytics-card master-admin-card">
        <h4><i class="bi bi-exclamation-triangle"></i> Master Admin Alerts</h4>
        
        <div class="insight-card critical">
          <div class="insight-title">Database Growth Rate</div>
          <div class="insight-description">Database size increasing 12% monthly. Plan storage expansion within 3 months.</div>
        </div>

        <div class="insight-card warning">
          <div class="insight-title">API Rate Limit Approaching</div>
          <div class="insight-description">Current API usage at 78% of limit. Consider increasing limits for growing customer base.</div>
        </div>

        <div class="insight-card positive">
          <div class="insight-title">Security Score: Excellent</div>
          <div class="insight-description">All security metrics in green. No vulnerabilities detected in latest security scan.</div>
        </div>

        <div class="insight-card critical">
          <div class="insight-title">Backup Schedule Review</div>
          <div class="insight-description">Last backup completed 2 hours ago. Consider more frequent backups during high-growth period.</div>
        </div>
      </div>
    </div>
  </div>
</main>

<!-- Scripts -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
<script src="auth.js"></script>
<script src="navigation-enforcement.js"></script>
<script src="load-sidebar.js"></script>
<script src="theme-manager.js"></script>
<script src="notifications-manager.js"></script>
<script src="activity-tracker.js"></script>

<!-- Master Admin Sidebar Loader -->
<script>
// Load Master Admin Sidebar
document.addEventListener('DOMContentLoaded', function() {
    if (window.vbmsAuth && vbmsAuth.isAuthenticated() && vbmsAuth.isMainAdmin()) {
        fetch('master-admin-sidebar.html')
            .then(response => response.text())
            .then(html => {
                document.getElementById('master-admin-sidebar-container').innerHTML = html;
                console.log('✅ Master Admin sidebar loaded successfully');
            })
            .catch(error => {
                console.error('❌ Error loading master admin sidebar:', error);
                window.location.href = 'dashboard.html';
            });
    } else {
        console.log('⚠️ Master Admin access required');
        alert('Access Denied: Master Admin access required');
        window.location.href = 'dashboard.html';
    }
});
</script>

<script>
// Authentication check - Master Admin Only
function checkAuthWithRetry(maxRetries = 3, delay = 100) {
  let retries = 0;
  
  function attemptAuth() {
    console.log('🔍 Master Admin Analytics Auth Check');
    
    if (!vbmsAuth.isAuthenticated()) {
      console.log('❌ Auth failed - redirecting to login');
      window.location.href = 'login.html';
      return;
    }

    const userRole = vbmsAuth.getCurrentRole();
    
    if ((!userRole || userRole === '') && retries < maxRetries) {
      retries++;
      setTimeout(attemptAuth, delay);
      return;
    }
    
    if (!userRole || userRole === '') {
      console.log('Auth check failed - no role found after retries');
      window.location.href = 'login.html';
      return;
    }
    
    if (!vbmsAuth.isMainAdmin()) {
      console.log('Master admin access check failed for user role:', userRole);
      alert('Access Denied: Master Admin access required for advanced analytics');
      
      setTimeout(() => {
        const verifiedRole = vbmsAuth.getCurrentRole();
        if (verifiedRole === 'admin' && !vbmsAuth.isMainAdmin()) {
          window.location.href = 'reports.html';
        } else if ((verifiedRole === 'customer' || verifiedRole === 'client') && !vbmsAuth.isMainAdmin()) {
          window.location.href = 'customer-dashboard.html';
        } else {
          window.location.href = 'login.html';
        }
      }, 150);
      return;
    }
    
    initializeMasterAdminAnalytics();
  }
  
  attemptAuth();
}

function initializeMasterAdminAnalytics() {
  // Initialize filters
  initializeFilters();
  
  // Load analytics data
  loadAnalyticsData();
  
  // Load real Stripe analytics
  loadStripeAnalytics();
  
  // Start real-time updates
  startRealTimeUpdates();
  
  // Track page access
  if (window.activityTracker) {
    activityTracker.trackPageView('Master Admin Analytics');
  }
}

function initializeFilters() {
  const timeRange = document.getElementById('timeRange');
  const dataScope = document.getElementById('dataScope');
  const analysisType = document.getElementById('analysisType');
  
  if (timeRange) timeRange.addEventListener('change', updateAnalytics);
  if (dataScope) dataScope.addEventListener('change', updateAnalytics);
  if (analysisType) analysisType.addEventListener('change', updateAnalytics);
}

function loadAnalyticsData() {
  console.log('📊 Loading master admin analytics data...');
  
  // Animate KPI values
  setTimeout(() => {
    animateKPI('totalRevenue', 847291, '$', true);
    animateKPI('activeUsers', 12847, '', true);
    animateKPI('conversionRate', 18.4, '', false, '%');
    animateKPI('systemUptime', 99.97, '', false, '%');
    animateKPI('customerSat', 4.8, '', false, '/5');
    animateKPI('churnRate', 2.1, '', false, '%');
  }, 500);
}

function animateKPI(elementId, targetValue, prefix = '', isNumber = false, suffix = '') {
  const element = document.getElementById(elementId);
  if (!element) return;

  let currentValue = 0;
  const increment = targetValue / 50;
  const timer = setInterval(() => {
    currentValue += increment;
    if (currentValue >= targetValue) {
      currentValue = targetValue;
      clearInterval(timer);
    }
    
    let displayValue = Math.floor(currentValue * 100) / 100;
    if (isNumber && displayValue >= 1000) {
      displayValue = Math.floor(displayValue / 1000) + 'K';
    }
    
    element.textContent = prefix + displayValue + suffix;
  }, 20);
}

function startRealTimeUpdates() {
  // Simulate real-time data updates
  setInterval(() => {
    updateRealTimeData();
  }, 30000); // Update every 30 seconds
}

function updateRealTimeData() {
  // Simulate real-time updates for demonstration
  console.log('🔄 Updating real-time analytics data...');
}

function updateAnalytics() {
  const timeRange = document.getElementById('timeRange').value;
  const dataScope = document.getElementById('dataScope').value;
  const analysisType = document.getElementById('analysisType').value;
  
  console.log(`📊 Updating analytics: ${timeRange}, ${dataScope}, ${analysisType}`);
  
  if (window.activityTracker) {
    activityTracker.trackCustomActivity('analytics_filter_change', 'Master Admin changed analytics filters', {
      priority: 'medium',
      module: 'Analytics',
      details: { timeRange, dataScope, analysisType }
    });
  }
}

// Analytics Functions
function generateAdvancedAnalytics() {
  if (window.activityTracker) {
    activityTracker.trackCustomActivity('ai_analytics_generation', 'Master Admin generated AI-powered analytics', {
      priority: 'high',
      module: 'Analytics'
    });
  }
  
  alert('AI-powered analytics generation initiated. This would use machine learning to provide deeper insights and predictions.');
}

async function loadStripeAnalytics() {
  try {
    console.log('📊 Loading real Stripe analytics...');
    
    // API base URL
    const API_BASE = window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1'
      ? 'http://localhost:5050'
      : 'https://vbms-backend.onrender.com';

    // Get auth token
    const token = localStorage.getItem('vbmsToken') || sessionStorage.getItem('vbmsToken');
    if (!token) {
      console.error('No auth token found for analytics');
      return;
    }

    // Get time period from filter
    const timePeriod = document.getElementById('timePeriod')?.value || '30d';

    // Fetch Stripe analytics
    const [analyticsResponse, predictionsResponse] = await Promise.all([
      fetch(`${API_BASE}/api/stripe/analytics?period=${timePeriod}`, {
        headers: {
          'Authorization': `Bearer ${token}`,
          'Content-Type': 'application/json'
        }
      }),
      fetch(`${API_BASE}/api/stripe/analytics/predictions`, {
        headers: {
          'Authorization': `Bearer ${token}`,
          'Content-Type': 'application/json'
        }
      })
    ]);

    if (!analyticsResponse.ok || !predictionsResponse.ok) {
      throw new Error(`API Error: ${analyticsResponse.status} / ${predictionsResponse.status}`);
    }

    const analytics = await analyticsResponse.json();
    const predictions = await predictionsResponse.json();

    console.log('📈 Stripe Analytics loaded:', analytics);
    console.log('🤖 AI Predictions loaded:', predictions);

    // Update KPIs with real data
    updateRealKPIs(analytics.summary);
    
    // Update AI predictions section
    updateAIPredictions(predictions);
    
    // Update insights with real data
    updateInsights(analytics, predictions);

  } catch (error) {
    console.error('❌ Error loading Stripe analytics:', error);
    // Keep mock data if API fails
  }
}

function updateRealKPIs(summary) {
  console.log('🔄 Updating KPIs with real data:', summary);
  
  // Animate real values
  setTimeout(() => {
    animateKPI('totalRevenue', summary.totalRevenue, '$', true);
    animateKPI('activeUsers', summary.activeSubscriptions, '', true);
    animateKPI('conversionRate', 18.4, '', false, '%'); // Keep this as calculated value
    animateKPI('systemUptime', 99.97, '', false, '%'); // Keep this as system metric
  }, 500);

  // Update additional metrics
  const mrrElement = document.querySelector('.kpi-card:nth-child(1) .kpi-value');
  if (mrrElement && summary.mrr) {
    setTimeout(() => {
      animateKPI('mrrValue', summary.mrr, '$', true);
    }, 800);
  }
}

function updateAIPredictions(predictions) {
  console.log('🤖 Updating AI predictions:', predictions);
  
  // Update the AI predictions section
  const aiSection = document.querySelector('.ai-insights .row');
  if (aiSection && predictions.insights) {
    const insightsHTML = predictions.insights.map(insight => `
      <div class="col-md-4">
        <div class="insight-title">${insight.title}</div>
        <div class="insight-description">${insight.description}</div>
        <div class="confidence-badge">Confidence: ${Math.round(insight.confidence * 100)}%</div>
      </div>
    `).join('');
    
    aiSection.innerHTML = insightsHTML;
  }

  // Update revenue forecast
  if (predictions.revenue) {
    const revenueCard = document.querySelector('.revenue-card .chart-placeholder small');
    if (revenueCard) {
      revenueCard.textContent = `Predicted 30-day revenue: $${predictions.revenue.next30Days.toLocaleString()}`;
    }
  }
}

function updateInsights(analytics, predictions) {
  console.log('💡 Updating insights with real data');
  
  const insightsContainer = document.querySelector('.insights-panel');
  if (!insightsContainer) return;

  // Generate dynamic insights based on real data
  const realInsights = [
    {
      type: 'positive',
      title: 'Revenue Performance',
      description: `Total revenue: $${analytics.summary.totalRevenue.toLocaleString()} with ${analytics.summary.activeSubscriptions} active subscriptions generating $${analytics.summary.mrr.toLocaleString()} MRR.`
    },
    {
      type: 'info',
      title: 'Customer Growth',
      description: `${analytics.summary.totalCustomers} new customers acquired in the selected period.`
    }
  ];

  // Add prediction insights
  if (predictions.insights) {
    realInsights.push(...predictions.insights.map(insight => ({
      type: insight.impact === 'high' ? 'positive' : insight.impact === 'medium' ? 'warning' : 'info',
      title: insight.title,
      description: insight.description
    })));
  }

  // Update insights display
  const insightCards = insightsContainer.querySelectorAll('.insight-card');
  realInsights.forEach((insight, index) => {
    if (insightCards[index]) {
      insightCards[index].className = `insight-card ${insight.type}`;
      insightCards[index].querySelector('.insight-title').textContent = insight.title;
      insightCards[index].querySelector('.insight-description').textContent = insight.description;
    }
  });
}

function exportAnalytics() {
  if (window.activityTracker) {
    activityTracker.trackCustomActivity('analytics_export', 'Master Admin exported analytics data', {
      priority: 'medium',
      module: 'Analytics'
    });
  }
  
  alert('Analytics data export initiated. Comprehensive data package will be prepared for download.');
}

function drillDownRevenue() {
  alert('Revenue drill-down analysis would show detailed revenue breakdowns by product, region, and time period.');
}

function analyzeUserBehavior() {
  alert('User behavior analysis would show detailed user journey maps, engagement patterns, and conversion paths.');
}

function optimizePerformance() {
  if (window.activityTracker) {
    activityTracker.trackCustomActivity('performance_optimization', 'Master Admin initiated performance optimization', {
      priority: 'high',
      module: 'System Performance'
    });
  }
  
  alert('Performance optimization initiated. System would analyze and implement performance improvements.');
}

function masterAdminReport() {
  if (window.activityTracker) {
    activityTracker.trackCustomActivity('master_admin_report', 'Master Admin generated comprehensive system report', {
      priority: 'critical',
      module: 'Analytics'
    });
  }
  
  alert('Master Admin comprehensive report generation initiated. This includes all system metrics, financials, and strategic insights.');
}

function viewGeoAnalytics() {
  alert('Geographic analytics would show interactive world map with user distribution, regional performance, and market opportunities.');
}

function optimizeFunnel() {
  alert('Conversion funnel optimization would analyze each step of the sales process and recommend improvements.');
}

// Start authentication check
checkAuthWithRetry();
</script>

</body>
</html>