<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>VBMS - My Inventory</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css" integrity="sha384-XGjxtQfXaH2tnPFa9x+ruJTuLE3Aa6LhHSWRr1XeTyhezb4abCG4ccI5AkVDxqC+" crossorigin="anonymous">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
  <style>
    :root {
        --accent: #f0b90b;
        --accent-light: #ffd700;
        --accent-glow: rgba(240, 185, 11, 0.4);
        --primary-dark: #d4a109;
        --secondary: #2c3e50;
        --success: #22c55e;
        --danger: #ef4444;
        --warning: #f59e0b;
        --info: #3b82f6;
        --purple: #a855f7;
        --cyan: #06b6d4;
        --light: #f8f9fa;
        --dark: #212529;
        --glass: rgba(255,255,255,0.95);
        --glass-glow: rgba(240, 185, 11, 0.15);
        --border: #e9ecef;
        --text: #212529;
        --text-muted: #6c757d;
        --card-bg: #ffffff;
        --card-shadow: 0 8px 32px rgba(240, 185, 11, 0.1);
        --bg: linear-gradient(135deg, #f8f9fa 0%, #f0f8ff 50%, #f8f4ff 100%);
        --sidebar-bg: rgba(255,255,255,0.98);
        --sidebar-link: #333;
        --sidebar-link-active: #000;
        --input-bg: rgba(255, 255, 255, 0.9);
        --text-main: #212529;
        --table-header: rgba(248, 249, 250, 0.95);
        --card-shadow-heavy: 0 12px 40px rgba(240, 185, 11, 0.15);
    }

    /* Dark theme - Modern Black/Gray with Energy */
    [data-theme="dark"] {
        --bg: linear-gradient(135deg, #000000 0%, #0a0a0a 25%, #1a1a1a 50%, #0f0f0f 100%);
        --light: #ffffff;
        --dark: #000000;
        --text: #ffffff;
        --text-muted: #a1a1aa;
        --card-bg: rgba(20, 20, 20, 0.95);
        --card-shadow: 0 8px 32px rgba(0, 0, 0, 0.8), 0 0 20px rgba(240, 185, 11, 0.15);
        --card-shadow-heavy: 0 12px 40px rgba(0, 0, 0, 0.6), 0 0 30px rgba(240, 185, 11, 0.2);
        --border: rgba(64, 64, 64, 0.4);
        --glass: rgba(18, 18, 18, 0.95);
        --glass-glow: rgba(240, 185, 11, 0.2);
        --sidebar-bg: rgba(12, 12, 12, 0.98);
        --sidebar-link: #d4d4d8;
        --sidebar-link-active: #ffffff;
        --accent: #f0b90b;
        --accent-light: #ffd700;
        --success: #22c55e;
        --danger: #ef4444;
        --warning: #f59e0b;
        --info: #3b82f6;
        --purple: #a855f7;
        --cyan: #06b6d4;
        --input-bg: rgba(30, 30, 30, 0.9);
        --text-main: #ffffff;
        --table-header: rgba(30, 30, 30, 0.95);
    }

    body {
        font-family: 'Inter', sans-serif;
        background: var(--bg);
        background-attachment: fixed;
        color: var(--text);
        margin: 0;
        padding: 0;
        transition: all 0.3s ease;
        min-height: 100vh;
        position: relative;
        overflow-x: hidden;
    }

    /* Animated Background Particles */
    body::before {
        content: '';
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: 
            radial-gradient(circle at 20% 80%, rgba(240, 185, 11, 0.1) 0%, transparent 50%),
            radial-gradient(circle at 80% 20%, rgba(240, 185, 11, 0.08) 0%, transparent 50%),
            radial-gradient(circle at 40% 40%, rgba(240, 185, 11, 0.05) 0%, transparent 50%);
        animation: float 20s ease-in-out infinite;
        pointer-events: none;
        z-index: -1;
    }

    [data-theme="dark"] body::before {
        background: 
            radial-gradient(circle at 20% 80%, rgba(240, 185, 11, 0.15) 0%, transparent 50%),
            radial-gradient(circle at 80% 20%, rgba(240, 185, 11, 0.12) 0%, transparent 50%),
            radial-gradient(circle at 40% 40%, rgba(240, 185, 11, 0.08) 0%, transparent 50%);
    }

    @keyframes float {
        0%, 100% { transform: translateY(0px) rotate(0deg); }
        33% { transform: translateY(-30px) rotate(1deg); }
        66% { transform: translateY(-10px) rotate(-1deg); }
    }

    /* Main Content */
    .main-content {
        margin-left: 320px;
        padding: 36px 24px 24px 24px;
        min-height: 100vh;
        background: none;
        transition: background .3s;
    }

    /* Enhanced Header */
    .header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 30px;
        padding: 25px 35px;
        background: var(--glass);
        backdrop-filter: blur(15px);
        border: 1px solid var(--border);
        border-radius: 20px;
        box-shadow: var(--card-shadow);
        transition: all 0.3s ease;
    }

    .header:hover {
        transform: translateY(-2px);
        box-shadow: 
            0 15px 40px rgba(240, 185, 11, 0.2),
            0 0 0 1px rgba(240, 185, 11, 0.1);
    }

    .header h1 {
        color: var(--accent);
        font-weight: 800;
        font-size: 2rem;
        margin: 0;
        display: flex;
        align-items: center;
        gap: 12px;
        text-shadow: 0 2px 10px rgba(240, 185, 11, 0.3);
    }

    .header-controls {
        display: flex;
        align-items: center;
        gap: 15px;
    }

    .btn-theme {
        background: var(--glass);
        backdrop-filter: blur(10px);
        border: 1px solid var(--border);
        border-radius: 12px;
        padding: 12px 16px;
        color: var(--accent);
        font-size: 1.2rem;
        transition: all 0.3s ease;
        cursor: pointer;
        box-shadow: 0 4px 15px rgba(240, 185, 11, 0.1);
    }

    .btn-theme:hover {
        background: var(--accent);
        color: #000;
        transform: translateY(-2px) scale(1.05);
        box-shadow: 0 8px 25px rgba(240, 185, 11, 0.3);
    }

    /* Enhanced Stats Grid */
    .stats-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
        gap: 25px;
        margin-bottom: 35px;
    }

    .stat-card {
        background: var(--glass);
        backdrop-filter: blur(15px);
        border: 1px solid var(--border);
        border-radius: 20px;
        padding: 30px;
        box-shadow: var(--card-shadow);
        transition: all 0.3s ease;
        position: relative;
        overflow: hidden;
        cursor: pointer;
    }

    .stat-card::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        height: 4px;
        background: linear-gradient(90deg, var(--accent), var(--accent-light));
        opacity: 0;
        transition: opacity 0.3s ease;
    }

    .stat-card:hover::before {
        opacity: 1;
    }

    .stat-card:hover {
        transform: translateY(-8px);
        box-shadow: 
            0 20px 50px rgba(240, 185, 11, 0.25),
            0 0 0 1px rgba(240, 185, 11, 0.1);
    }

    .stat-header {
        display: flex;
        justify-content: space-between;
        align-items: flex-start;
        margin-bottom: 15px;
    }

    .stat-info {
        flex: 1;
    }

    .stat-icon {
        font-size: 2.5rem;
        color: var(--accent);
        opacity: 0.8;
        transition: all 0.3s ease;
    }

    .stat-card:hover .stat-icon {
        transform: scale(1.1) rotate(5deg);
        opacity: 1;
    }

    .analytics-title {
        font-weight: 700;
        font-size: 1rem;
        color: var(--accent);
        margin-bottom: 8px;
        text-transform: uppercase;
        letter-spacing: 0.5px;
    }

    .analytics-value {
        font-size: 2.8rem;
        font-weight: 800;
        letter-spacing: 1px;
        color: var(--text);
        line-height: 1;
        margin-bottom: 8px;
    }

    .analytics-desc {
        font-size: 0.9rem;
        color: var(--text-muted);
        margin: 0;
    }

    .stat-card.lowstock .analytics-value {
        color: var(--warning);
    }

    .stat-card.outofstock .analytics-value {
        color: var(--danger);
    }

    /* Enhanced Controls Section */
    .controls-section {
        background: var(--glass);
        backdrop-filter: blur(15px);
        border: 1px solid var(--border);
        border-radius: 20px;
        padding: 30px;
        margin-bottom: 30px;
        box-shadow: var(--card-shadow);
        transition: all 0.3s ease;
    }

    .controls-section:hover {
        transform: translateY(-3px);
        box-shadow: 
            0 15px 40px rgba(240, 185, 11, 0.2),
            0 0 0 1px rgba(240, 185, 11, 0.1);
    }

    .controls-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 25px;
        padding-bottom: 15px;
        border-bottom: 1px solid var(--border);
    }

    .controls-header h3 {
        color: var(--accent);
        font-weight: 700;
        margin: 0;
        display: flex;
        align-items: center;
        gap: 10px;
    }

    .inventory-toolbar {
        display: flex;
        flex-wrap: wrap;
        align-items: center;
        gap: 15px;
    }

    .inventory-toolbar input,
    .inventory-toolbar select {
        background: var(--glass);
        backdrop-filter: blur(10px);
        border: 1px solid var(--border);
        border-radius: 12px;
        padding: 12px 16px;
        color: var(--text);
        font-size: 0.95rem;
        transition: all 0.3s ease;
        min-width: 150px;
    }

    .inventory-toolbar input:focus,
    .inventory-toolbar select:focus {
        outline: none;
        border-color: var(--accent);
        box-shadow: 0 0 0 3px rgba(240, 185, 11, 0.1);
        transform: translateY(-1px);
    }

    .btn-secondary,
    .btn-primary {
        background: var(--glass);
        backdrop-filter: blur(10px);
        border: 1px solid var(--accent);
        border-radius: 12px;
        padding: 12px 20px;
        color: var(--accent);
        font-weight: 600;
        font-size: 0.95rem;
        transition: all 0.3s ease;
        cursor: pointer;
        display: flex;
        align-items: center;
        gap: 8px;
        text-decoration: none;
    }

    .btn-primary {
        background: var(--accent);
        color: #000;
        font-weight: 700;
    }

    .btn-secondary:hover {
        background: var(--accent);
        color: #000;
        transform: translateY(-2px);
        box-shadow: 0 5px 15px rgba(240, 185, 11, 0.3);
    }

    .btn-primary:hover {
        background: var(--accent-light);
        transform: translateY(-2px) scale(1.02);
        box-shadow: 0 8px 25px rgba(240, 185, 11, 0.4);
    }

    .control-actions {
        display: flex;
        align-items: center;
        gap: 12px;
    }

    /* Enhanced Charts Section */
    .charts-section {
        background: var(--glass);
        backdrop-filter: blur(15px);
        border: 1px solid var(--border);
        border-radius: 20px;
        padding: 30px;
        margin-bottom: 30px;
        box-shadow: var(--card-shadow);
        transition: all 0.3s ease;
    }

    .charts-section:hover {
        transform: translateY(-5px);
        box-shadow: 
            0 20px 50px rgba(240, 185, 11, 0.15),
            0 0 0 1px rgba(240, 185, 11, 0.1);
    }

    .charts-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 25px;
        padding-bottom: 15px;
        border-bottom: 1px solid var(--border);
    }

    .charts-header h3 {
        color: var(--accent);
        font-weight: 700;
        margin: 0;
        display: flex;
        align-items: center;
        gap: 10px;
    }

    .charts-row {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
        gap: 25px;
    }

    .chart-box {
        background: var(--glass);
        backdrop-filter: blur(10px);
        border: 1px solid var(--border);
        border-radius: 16px;
        padding: 25px;
        box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
        transition: all 0.3s ease;
        position: relative;
        overflow: hidden;
        height: 300px;
    }

    .chart-box::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        height: 3px;
        background: linear-gradient(90deg, var(--accent), var(--accent-light));
    }

    .chart-box:hover {
        transform: translateY(-5px);
        box-shadow: 0 15px 40px rgba(240, 185, 11, 0.2);
    }

    .chart-title {
        color: var(--accent);
        font-weight: 700;
        font-size: 1.1rem;
        margin-bottom: 20px;
        display: flex;
        align-items: center;
        gap: 10px;
    }

    /* Enhanced Product Grid */
    .products-section {
        background: var(--glass);
        backdrop-filter: blur(15px);
        border: 1px solid var(--border);
        border-radius: 20px;
        padding: 30px;
        margin-bottom: 30px;
        box-shadow: var(--card-shadow);
        transition: all 0.3s ease;
    }

    .products-section:hover {
        transform: translateY(-3px);
        box-shadow: 
            0 15px 40px rgba(240, 185, 11, 0.2),
            0 0 0 1px rgba(240, 185, 11, 0.1);
    }

    .products-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 25px;
        padding-bottom: 15px;
        border-bottom: 1px solid var(--border);
    }

    .products-header h3 {
        color: var(--accent);
        font-weight: 700;
        margin: 0;
        display: flex;
        align-items: center;
        gap: 10px;
    }

    .products-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
        gap: 20px;
    }

    .product-card {
        background: var(--glass);
        backdrop-filter: blur(10px);
        border: 1px solid var(--border);
        border-radius: 16px;
        padding: 20px;
        box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
        transition: all 0.3s ease;
        position: relative;
        overflow: hidden;
    }

    .product-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 15px 40px rgba(240, 185, 11, 0.2);
    }

    .product-image {
        width: 100%;
        height: 150px;
        background: var(--glass);
        border-radius: 12px;
        display: flex;
        align-items: center;
        justify-content: center;
        margin-bottom: 15px;
        font-size: 3rem;
        color: var(--accent);
        border: 2px solid var(--border);
    }

    .product-info h4 {
        color: var(--text);
        font-weight: 700;
        font-size: 1.1rem;
        margin-bottom: 8px;
    }

    .product-sku {
        color: var(--text-muted);
        font-size: 0.85rem;
        margin-bottom: 8px;
    }

    .product-price {
        color: var(--accent);
        font-weight: 700;
        font-size: 1.2rem;
        margin-bottom: 8px;
    }

    .product-stock {
        display: flex;
        align-items: center;
        gap: 8px;
        margin-bottom: 15px;
    }

    .stock-indicator {
        width: 12px;
        height: 12px;
        border-radius: 50%;
    }

    .stock-indicator.in-stock { background: var(--success); }
    .stock-indicator.low-stock { background: var(--warning); }
    .stock-indicator.out-stock { background: var(--danger); }

    .category-badge {
        background: var(--glass-glow);
        color: var(--accent);
        padding: 4px 12px;
        border-radius: 20px;
        font-size: 0.8rem;
        font-weight: 600;
        display: inline-block;
        margin-bottom: 15px;
    }

    .product-actions {
        display: flex;
        gap: 8px;
    }

    .btn-action {
        background: var(--glass);
        backdrop-filter: blur(10px);
        border: 1px solid var(--accent);
        border-radius: 8px;
        padding: 6px 12px;
        color: var(--accent);
        font-size: 0.85rem;
        font-weight: 600;
        transition: all 0.3s ease;
        cursor: pointer;
        flex: 1;
        text-align: center;
    }

    .btn-action:hover {
        background: var(--accent);
        color: #000;
        transform: translateY(-2px);
        box-shadow: 0 5px 15px rgba(240, 185, 11, 0.3);
    }

    /* Enhanced Modals */
    .modal-content {
        background: var(--glass);
        backdrop-filter: blur(20px);
        border: 2px solid var(--accent);
        border-radius: 20px;
        box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
    }

    .modal-header {
        border-bottom: 1px solid var(--border);
        background: linear-gradient(135deg, var(--glass), rgba(240, 185, 11, 0.05));
    }

    .modal-title {
        color: var(--accent);
        font-weight: 700;
    }

    .form-control, .form-select {
        background: var(--glass);
        backdrop-filter: blur(10px);
        border: 1px solid var(--border);
        border-radius: 12px;
        color: var(--text);
        transition: all 0.3s ease;
    }

    .form-control:focus, .form-select:focus {
        background: var(--glass);
        border-color: var(--accent);
        box-shadow: 0 0 0 3px rgba(240, 185, 11, 0.1);
        color: var(--text);
    }

    /* Enhanced Toast Container */
    .toast-container {
        position: fixed;
        top: 30px;
        right: 30px;
        z-index: 9999;
        display: flex;
        flex-direction: column;
        gap: 10px;
    }

    .toast-vbms {
        background: var(--glass);
        backdrop-filter: blur(15px);
        border: 1px solid var(--accent);
        border-radius: 16px;
        padding: 16px 24px;
        color: var(--text);
        font-size: 1rem;
        font-weight: 600;
        display: flex;
        align-items: center;
        gap: 12px;
        box-shadow: 
            0 8px 25px rgba(240, 185, 11, 0.3),
            0 0 0 1px rgba(240, 185, 11, 0.1);
        animation: slideInRight 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        transition: all 0.3s ease;
        min-width: 280px;
        position: relative;
        overflow: hidden;
    }

    .toast-vbms::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        height: 3px;
        background: linear-gradient(90deg, var(--accent), var(--accent-light));
    }

    .toast-vbms:hover {
        transform: translateY(-2px) scale(1.02);
        box-shadow: 
            0 12px 30px rgba(240, 185, 11, 0.4),
            0 0 0 1px rgba(240, 185, 11, 0.2);
    }

    .toast-vbms.success {
        border-color: var(--success);
    }

    .toast-vbms.success::before {
        background: var(--success);
    }

    .toast-vbms.error {
        border-color: var(--danger);
    }

    .toast-vbms.error::before {
        background: var(--danger);
    }

    .toast-vbms.warning {
        border-color: var(--warning);
    }

    .toast-vbms.warning::before {
        background: var(--warning);
    }

    .toast-vbms i {
        color: var(--accent);
        font-size: 1.2rem;
    }

    .toast-vbms.success i {
        color: var(--success);
    }

    .toast-vbms.error i {
        color: var(--danger);
    }

    .toast-vbms.warning i {
        color: var(--warning);
    }

    @keyframes slideInRight {
        from {
            opacity: 0;
            transform: translateX(100px);
        }
        to {
            opacity: 1;
            transform: translateX(0);
        }
    }

    /* Responsive Design */
    @media (max-width: 1200px) {
        .main-content {
            margin-left: 0;
            padding: 20px 15px;
        }

        .stats-grid {
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
        }

        .charts-row {
            grid-template-columns: 1fr;
            gap: 20px;
        }

        .products-grid {
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 15px;
        }
    }

    @media (max-width: 768px) {
        .main-content {
            padding: 15px 10px;
        }

        .header {
            flex-direction: column;
            gap: 15px;
            text-align: center;
            padding: 20px;
        }

        .header h1 {
            font-size: 1.5rem;
        }

        .stats-grid {
            grid-template-columns: 1fr;
            gap: 15px;
        }

        .stat-card {
            padding: 20px;
        }

        .analytics-value {
            font-size: 2.2rem;
        }

        .controls-section,
        .charts-section,
        .products-section {
            padding: 20px;
        }

        .inventory-toolbar {
            flex-direction: column;
            align-items: stretch;
            gap: 10px;
        }

        .inventory-toolbar input,
        .inventory-toolbar select {
            min-width: auto;
        }

        .products-grid {
            grid-template-columns: 1fr;
        }

        .toast-container {
            top: 15px;
            right: 15px;
            left: 15px;
        }

        .toast-vbms {
            min-width: auto;
        }
    }

    @media (max-width: 480px) {
        .main-content {
            padding: 10px 8px;
        }

        .header {
            padding: 15px;
        }

        .header h1 {
            font-size: 1.3rem;
        }

        .stat-card {
            padding: 15px;
        }

        .analytics-value {
            font-size: 2rem;
        }

        .controls-section,
        .charts-section,
        .products-section {
            padding: 15px;
        }

        .chart-box {
            height: 250px;
        }

        .product-card {
            padding: 15px;
        }

        .product-image {
            height: 120px;
        }
    }

    /* Enhanced Scrollbars */
    ::-webkit-scrollbar {
        width: 10px;
        background: transparent;
    }

    ::-webkit-scrollbar-thumb {
        background: linear-gradient(135deg, var(--accent), var(--accent-light));
        border-radius: 6px;
        border: 2px solid transparent;
        background-clip: content-box;
    }

    ::-webkit-scrollbar-thumb:hover {
        background: linear-gradient(135deg, var(--accent-light), var(--accent));
        background-clip: content-box;
    }

    ::-webkit-scrollbar-track {
        background: rgba(240, 185, 11, 0.1);
        border-radius: 6px;
    }
  </style>
</head>
<body>
<!--  SIDEBAR  -->
<div id="sidebar-container"></div>

<!--  MAIN  -->
<main class="main-content">
  <!-- Enhanced Header -->
  <div class="header">
    <h1><i class="bi bi-boxes"></i> My Inventory</h1>
    <div class="header-controls">
      <button class="btn-theme" onclick="toggleTheme()" title="Toggle light/dark theme">
        <i id="themeIcon" class="bi bi-moon-fill"></i>
      </button>
    </div>
  </div>

  <!-- Enhanced Stats Grid -->
  <div class="stats-grid">
    <div class="stat-card">
      <div class="stat-header">
        <div class="stat-info">
          <div class="analytics-title">Total Products</div>
          <div class="analytics-value" id="totalProducts">0</div>
        </div>
        <i class="bi bi-boxes stat-icon"></i>
      </div>
      <div class="analytics-desc">All inventory items</div>
    </div>
    <div class="stat-card">
      <div class="stat-header">
        <div class="stat-info">
          <div class="analytics-title">Total Value</div>
          <div class="analytics-value" id="totalValue">$0</div>
        </div>
        <i class="bi bi-cash-stack stat-icon"></i>
      </div>
      <div class="analytics-desc">Inventory worth</div>
    </div>
    <div class="stat-card lowstock">
      <div class="stat-header">
        <div class="stat-info">
          <div class="analytics-title">Low Stock</div>
          <div class="analytics-value" id="lowStock">0</div>
        </div>
        <i class="bi bi-exclamation-triangle stat-icon"></i>
      </div>
      <div class="analytics-desc">Items below 10 units</div>
    </div>
    <div class="stat-card outofstock">
      <div class="stat-header">
        <div class="stat-info">
          <div class="analytics-title">Out of Stock</div>
          <div class="analytics-value" id="outStock">0</div>
        </div>
        <i class="bi bi-x-circle stat-icon"></i>
      </div>
      <div class="analytics-desc">Items need restocking</div>
    </div>
    <div class="stat-card">
      <div class="stat-header">
        <div class="stat-info">
          <div class="analytics-title">Categories</div>
          <div class="analytics-value" id="categoryCount">0</div>
        </div>
        <i class="bi bi-grid-3x3-gap stat-icon"></i>
      </div>
      <div class="analytics-desc">Product categories</div>
    </div>
  </div>

  <!-- Enhanced Controls Section -->
  <div class="controls-section">
    <div class="controls-header">
      <h3><i class="bi bi-funnel"></i> Inventory Management</h3>
    </div>
    <div class="inventory-toolbar">
      <input type="search" id="inventorySearch" placeholder="ðŸ” Search products..." />
      <select id="categoryFilter">
        <option value="">All Categories</option>
        <option value="Food & Beverages">Food & Beverages</option>
        <option value="Electronics">Electronics</option>
        <option value="Clothing">Clothing</option>
        <option value="Home & Garden">Home & Garden</option>
        <option value="Health & Beauty">Health & Beauty</option>
        <option value="Sports">Sports</option>
        <option value="Books">Books</option>
        <option value="Other">Other</option>
      </select>
      <select id="stockFilter">
        <option value="">All Stock Levels</option>
        <option value="in-stock">In Stock (>10)</option>
        <option value="low-stock">Low Stock (1-10)</option>
        <option value="out-stock">Out of Stock (0)</option>
      </select>
      <select id="sortBy">
        <option value="name-asc">Name A-Z</option>
        <option value="name-desc">Name Z-A</option>
        <option value="price-desc">Price High-Low</option>
        <option value="price-asc">Price Low-High</option>
        <option value="stock-desc">Stock High-Low</option>
        <option value="stock-asc">Stock Low-High</option>
      </select>
      <div class="control-actions">
        <button class="btn-secondary" id="exportBtn" onclick="exportInventory()">
          <i class="bi bi-download"></i> Export
        </button>
        <button class="btn-secondary" onclick="document.getElementById('bulkUpload').click()">
          <i class="bi bi-upload"></i> Bulk Upload
        </button>
        <button class="btn-primary" onclick="openAddProductModal()">
          <i class="bi bi-plus-circle"></i> Add Product
        </button>
      </div>
    </div>
    <input type="file" id="bulkUpload" accept=".csv,.xlsx,.xls" style="display: none;" onchange="handleBulkUpload(event)">
  </div>

  <!-- Enhanced Charts Section -->
  <div class="charts-section">
    <div class="charts-header">
      <h3><i class="bi bi-bar-chart"></i> Inventory Analytics</h3>
    </div>
    <div class="charts-row">
      <div class="chart-box">
        <div class="chart-title"><i class="bi bi-pie-chart"></i> Products by Category</div>
        <canvas id="categoryChart"></canvas>
      </div>
      <div class="chart-box">
        <div class="chart-title"><i class="bi bi-graph-up"></i> Stock Levels Distribution</div>
        <canvas id="stockChart"></canvas>
      </div>
      <div class="chart-box">
        <div class="chart-title"><i class="bi bi-cash-stack"></i> Value by Category</div>
        <canvas id="valueChart"></canvas>
      </div>
    </div>
  </div>

  <!-- Receipts Section -->
  <div class="receipts-section" style="margin: 30px 0; padding: 25px; background: var(--card-bg); border-radius: 16px; box-shadow: var(--card-shadow);">
    <div class="receipts-header" style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
      <h3 style="margin: 0; color: var(--text);"><i class="bi bi-receipt"></i> Receipts</h3>
      <button class="btn-primary" onclick="document.getElementById('receiptUpload').click()">
        <i class="bi bi-cloud-upload"></i> Upload Receipt
      </button>
    </div>
    <input type="file" id="receiptUpload" accept=".pdf,.csv,.xlsx,.xls" style="display: none;" onchange="handleReceiptUpload(event)">
    <div class="receipts-table-container" style="overflow-x: auto;">
      <table class="table" style="color: var(--text);">
        <thead style="background: var(--table-header);">
          <tr>
            <th>Name</th>
            <th>Type</th>
            <th>Size</th>
            <th>Upload Date</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody id="receiptsTableBody">
          <!-- Receipts will be populated here -->
        </tbody>
      </table>
    </div>
  </div>

  <!-- Enhanced Products Section -->
  <div class="products-section">
    <div class="products-header">
      <h3><i class="bi bi-grid"></i> Product Catalog</h3>
      <div class="view-toggle">
        <button class="btn-secondary" id="gridViewBtn" onclick="setViewMode('grid')">
          <i class="bi bi-grid-3x3-gap"></i> Grid
        </button>
        <button class="btn-secondary" id="listViewBtn" onclick="setViewMode('list')">
          <i class="bi bi-list"></i> List
        </button>
      </div>
    </div>
    <div class="products-grid" id="productsContainer">
      <!-- Products will be populated by JavaScript -->
    </div>
  </div>

  <!-- Add/Edit Product Modal -->
  <div class="modal fade" id="productModal" tabindex="-1">
    <div class="modal-dialog modal-lg">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="productModalTitle">Add New Product</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
        </div>
        <div class="modal-body">
          <form id="productForm">
            <div class="row">
              <div class="col-md-6 mb-3">
                <label class="form-label">Product Name *</label>
                <input type="text" class="form-control" id="productName" required>
              </div>
              <div class="col-md-6 mb-3">
                <label class="form-label">SKU</label>
                <input type="text" class="form-control" id="productSKU">
              </div>
            </div>
            <div class="row">
              <div class="col-md-6 mb-3">
                <label class="form-label">Price *</label>
                <input type="number" class="form-control" id="productPrice" step="0.01" required>
              </div>
              <div class="col-md-6 mb-3">
                <label class="form-label">Stock Quantity *</label>
                <input type="number" class="form-control" id="productStock" required>
              </div>
            </div>
            <div class="row">
              <div class="col-md-6 mb-3">
                <label class="form-label">Category *</label>
                <select class="form-select" id="productCategory" required>
                  <option value="">Select Category</option>
                  <option value="Food & Beverages">Food & Beverages</option>
                  <option value="Electronics">Electronics</option>
                  <option value="Clothing">Clothing</option>
                  <option value="Home & Garden">Home & Garden</option>
                  <option value="Health & Beauty">Health & Beauty</option>
                  <option value="Sports">Sports</option>
                  <option value="Books">Books</option>
                  <option value="Other">Other</option>
                </select>
              </div>
              <div class="col-md-6 mb-3">
                <label class="form-label">Status</label>
                <select class="form-select" id="productStatus">
                  <option value="active">Active</option>
                  <option value="inactive">Inactive</option>
                </select>
              </div>
            </div>
            <div class="mb-3">
              <label class="form-label">Description</label>
              <textarea class="form-control" id="productDescription" rows="3"></textarea>
            </div>
            <div class="mb-3">
              <label class="form-label">Image URL</label>
              <input type="url" class="form-control" id="productImage" placeholder="https://example.com/image.jpg">
            </div>
          </form>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
          <button type="button" class="btn-primary" onclick="saveProduct()">Save Product</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Enhanced Toast Container -->
  <div class="toast-container" id="toastArea"></div>

  <footer class="mt-5 text-center" style="color: var(--text-muted); font-size: 0.9rem; padding: 20px;">
    &copy; 2025 VBMS. All rights reserved.
  </footer>
</main>

<!-- SCRIPTS -->
<script src="config.js"></script>
<script src="navigation-enforcement.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="https://unpkg.com/xlsx/dist/xlsx.full.min.js"></script>
<script src="auth.js"></script>
<script src="load-sidebar.js"></script>
<script src="theme-manager.js"></script>
<script>
// Customer Inventory - Check authentication
console.log('Customer Inventory - Checking authentication...');

// Check if user is authenticated and is a customer
if (!vbmsAuth.isAuthenticated()) {
  console.log('Not authenticated - redirecting to login');
  window.location.href = 'customer-login.html';
}

// Role-based access control
const userRole = vbmsAuth.getCurrentRole();
if (userRole !== 'customer' && userRole !== 'client') {
  alert('Access Denied: Customer access required');
  window.location.href = vbmsAuth.getRoleRedirectUrl();
}

console.log('Customer Inventory - Access granted');

// ===== ENHANCED INVENTORY DATA =====
let inventoryProducts = [
  {
    id: 1,
    name: "Premium Coffee Beans",
    sku: "COF-001",
    price: 24.99,
    stock: 45,
    category: "Food & Beverages",
    description: "High-quality Arabica coffee beans from Colombia",
    image: null,
    status: "active",
    source: "manual",
    stripeProductId: null,
    lastUpdated: "2025-01-31"
  },
  {
    id: 2,
    name: "Wireless Bluetooth Headphones",
    sku: "ELE-002",
    price: 89.99,
    stock: 8,
    category: "Electronics",
    description: "Noise-cancelling wireless headphones with 30-hour battery",
    image: null,
    status: "active",
    source: "manual",
    stripeProductId: null,
    lastUpdated: "2025-01-30"
  },
  {
    id: 3,
    name: "Organic Green Tea",
    sku: "TEA-003",
    price: 15.50,
    stock: 0,
    category: "Food & Beverages",
    description: "Premium organic green tea leaves",
    image: null,
    status: "active",
    source: "manual",
    stripeProductId: null,
    lastUpdated: "2025-01-29"
  },
  {
    id: 4,
    name: "Cotton T-Shirt",
    sku: "CLO-004",
    price: 19.99,
    stock: 25,
    category: "Clothing",
    description: "100% organic cotton t-shirt available in multiple colors",
    image: null,
    status: "active",
    source: "manual",
    stripeProductId: null,
    lastUpdated: "2025-01-31"
  },
  {
    id: 5,
    name: "LED Desk Lamp",
    sku: "HOM-005",
    price: 34.99,
    stock: 12,
    category: "Home & Garden",
    description: "Adjustable LED desk lamp with touch controls",
    image: null,
    status: "active",
    source: "manual",
    stripeProductId: null,
    lastUpdated: "2025-01-30"
  },
  {
    id: 6,
    name: "Protein Powder",
    sku: "HEA-006",
    price: 49.99,
    stock: 3,
    category: "Health & Beauty",
    description: "Whey protein powder for muscle building",
    image: null,
    status: "active",
    source: "manual",
    stripeProductId: null,
    lastUpdated: "2025-01-28"
  },
  {
    id: 7,
    name: "Yoga Mat",
    sku: "SPO-007",
    price: 29.99,
    stock: 18,
    category: "Sports",
    description: "Non-slip yoga mat for all fitness levels",
    image: null,
    status: "active",
    source: "manual",
    stripeProductId: null,
    lastUpdated: "2025-01-31"
  },
  {
    id: 8,
    name: "JavaScript Programming Book",
    sku: "BOO-008",
    price: 39.99,
    stock: 7,
    category: "Books",
    description: "Complete guide to modern JavaScript programming",
    image: null,
    status: "active",
    source: "manual",
    stripeProductId: null,
    lastUpdated: "2025-01-29"
  }
];

let currentViewMode = 'grid';
let currentEditingId = null;

// Theme functions now handled by theme-manager.js
function logout() {
  vbmsAuth.logout();
}

// ===== ENHANCED ANALYTICS =====
function updateAnalytics(products = inventoryProducts) {
  const totalProducts = products.length;
  const totalValue = products.reduce((sum, product) => sum + (product.price * product.stock), 0);
  const lowStock = products.filter(p => p.stock > 0 && p.stock <= 10).length;
  const outStock = products.filter(p => p.stock === 0).length;
  const categories = [...new Set(products.map(p => p.category))].length;

  document.getElementById('totalProducts').textContent = totalProducts;
  document.getElementById('totalValue').textContent = `$${totalValue.toFixed(2)}`;
  document.getElementById('lowStock').textContent = lowStock;
  document.getElementById('outStock').textContent = outStock;
  document.getElementById('categoryCount').textContent = categories;
}

// ===== ENHANCED FILTERING AND SORTING =====
function getFilteredAndSortedProducts() {
  const searchTerm = document.getElementById('inventorySearch').value.toLowerCase();
  const categoryFilter = document.getElementById('categoryFilter').value;
  const stockFilter = document.getElementById('stockFilter').value;
  const sortBy = document.getElementById('sortBy').value;

  let filtered = inventoryProducts.filter(product => {
    const matchesSearch = 
      product.name.toLowerCase().includes(searchTerm) ||
      product.sku.toLowerCase().includes(searchTerm) ||
      product.description.toLowerCase().includes(searchTerm);
    
    const matchesCategory = !categoryFilter || product.category === categoryFilter;
    
    let matchesStock = true;
    if (stockFilter === 'in-stock') matchesStock = product.stock > 10;
    else if (stockFilter === 'low-stock') matchesStock = product.stock > 0 && product.stock <= 10;
    else if (stockFilter === 'out-stock') matchesStock = product.stock === 0;
    
    return matchesSearch && matchesCategory && matchesStock;
  });

  // Apply sorting
  filtered.sort((a, b) => {
    switch(sortBy) {
      case 'name-asc':
        return a.name.localeCompare(b.name);
      case 'name-desc':
        return b.name.localeCompare(a.name);
      case 'price-desc':
        return b.price - a.price;
      case 'price-asc':
        return a.price - b.price;
      case 'stock-desc':
        return b.stock - a.stock;
      case 'stock-asc':
        return a.stock - b.stock;
      default:
        return 0;
    }
  });

  return filtered;
}

// ===== ENHANCED PRODUCT RENDERING =====
function renderProducts() {
  const filtered = getFilteredAndSortedProducts();
  updateAnalytics(filtered);
  
  const container = document.getElementById('productsContainer');
  
  if (filtered.length === 0) {
    container.innerHTML = `
      <div style="grid-column: 1 / -1; text-align: center; padding: 60px 20px; color: var(--text-muted);">
        <i class="bi bi-search" style="font-size: 3rem; margin-bottom: 20px; display: block;"></i>
        <h4>No products found</h4>
        <p>Try adjusting your search criteria or add new products to your inventory.</p>
        <button class="btn-primary mt-3" onclick="openAddProductModal()">
          <i class="bi bi-plus-circle"></i> Add Your First Product
        </button>
      </div>
    `;
    return;
  }

  if (currentViewMode === 'grid') {
    container.className = 'products-grid';
    container.innerHTML = filtered.map(product => `
      <div class="product-card">
        <div class="product-image">
          ${product.image ? 
            `<img src="${product.image}" alt="${product.name}" style="width: 100%; height: 100%; object-fit: cover; border-radius: 12px;">` :
            `<i class="bi bi-box"></i>`
          }
        </div>
        <div class="product-info">
          <h4>${product.name}</h4>
          <div class="product-sku">SKU: ${product.sku}</div>
          <div class="product-price">$${product.price.toFixed(2)}</div>
          <div class="category-badge">${product.category}</div>
          <div class="product-stock">
            <div class="stock-indicator ${getStockStatus(product.stock)}"></div>
            <span>${product.stock} in stock</span>
          </div>
          <div class="product-actions">
            <button class="btn-action" onclick="editProduct(${product.id})">
              <i class="bi bi-pencil"></i> Edit
            </button>
            <button class="btn-action" onclick="duplicateProduct(${product.id})">
              <i class="bi bi-files"></i> Copy
            </button>
            <button class="btn-action" onclick="deleteProduct(${product.id})" style="border-color: var(--danger); color: var(--danger);">
              <i class="bi bi-trash"></i> Delete
            </button>
          </div>
        </div>
      </div>
    `).join('');
  } else {
    // List view implementation
    container.className = 'products-list';
    container.innerHTML = `
      <div style="background: var(--glass); border-radius: 16px; overflow: hidden;">
        <table class="table mb-0" style="background: transparent;">
          <thead style="background: var(--table-header);">
            <tr>
              <th>Product</th>
              <th>SKU</th>
              <th>Category</th>
              <th>Price</th>
              <th>Stock</th>
              <th>Type</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody>
            ${filtered.map(product => `
              <tr>
                <td>
                  <div class="d-flex align-items-center">
                    <div style="width: 40px; height: 40px; background: var(--glass); border-radius: 8px; display: flex; align-items: center; justify-content: center; margin-right: 12px;">
                      ${product.image ? 
                        `<img src="${product.image}" alt="${product.name}" style="width: 100%; height: 100%; object-fit: cover; border-radius: 8px;">` :
                        `<i class="bi bi-box"></i>`
                      }
                    </div>
                    <div>
                      <strong>${product.name}</strong>
                      <div class="text-muted small">${product.description ? product.description.substring(0, 50) + '...' : ''}</div>
                    </div>
                  </div>
                </td>
                <td>${product.sku}</td>
                <td><span class="category-badge">${product.category}</span></td>
                <td><strong>$${product.price.toFixed(2)}</strong></td>
                <td>
                  <div class="d-flex align-items-center">
                    <div class="stock-indicator ${getStockStatus(product.stock)} me-2"></div>
                    ${product.stock}
                  </div>
                </td>
                <td>
                  <span class="badge bg-secondary">Manual</span>
                </td>
                <td>
                  <button class="btn btn-sm btn-outline-warning me-1" onclick="editProduct(${product.id})" title="Edit">
                    <i class="bi bi-pencil"></i>
                  </button>
                  <button class="btn btn-sm btn-outline-info me-1" onclick="duplicateProduct(${product.id})" title="Duplicate">
                    <i class="bi bi-files"></i>
                  </button>
                  <button class="btn btn-sm btn-outline-danger" onclick="deleteProduct(${product.id})" title="Delete">
                    <i class="bi bi-trash"></i>
                  </button>
                </td>
              </tr>
            `).join('')}
          </tbody>
        </table>
      </div>
    `;
  }
}

function getStockStatus(stock) {
  if (stock === 0) return 'out-stock';
  if (stock <= 10) return 'low-stock';
  return 'in-stock';
}

function setViewMode(mode) {
  currentViewMode = mode;
  document.getElementById('gridViewBtn').classList.toggle('active', mode === 'grid');
  document.getElementById('listViewBtn').classList.toggle('active', mode === 'list');
  renderProducts();
}

// ===== PRODUCT MANAGEMENT =====
function openAddProductModal() {
  currentEditingId = null;
  document.getElementById('productModalTitle').textContent = 'Add New Product';
  document.getElementById('productForm').reset();
  new bootstrap.Modal(document.getElementById('productModal')).show();
}

function editProduct(id) {
  const product = inventoryProducts.find(p => p.id === id);
  if (!product) return;

  currentEditingId = id;
  document.getElementById('productModalTitle').textContent = 'Edit Product';
  
  document.getElementById('productName').value = product.name;
  document.getElementById('productSKU').value = product.sku;
  document.getElementById('productPrice').value = product.price;
  document.getElementById('productStock').value = product.stock;
  document.getElementById('productCategory').value = product.category;
  document.getElementById('productStatus').value = product.status;
  document.getElementById('productDescription').value = product.description;
  document.getElementById('productImage').value = product.image || '';

  new bootstrap.Modal(document.getElementById('productModal')).show();
}

function saveProduct() {
  const name = document.getElementById('productName').value.trim();
  const sku = document.getElementById('productSKU').value.trim();
  const price = parseFloat(document.getElementById('productPrice').value);
  const stock = parseInt(document.getElementById('productStock').value);
  const category = document.getElementById('productCategory').value;
  const status = document.getElementById('productStatus').value;
  const description = document.getElementById('productDescription').value.trim();
  const image = document.getElementById('productImage').value.trim();

  if (!name || !price || !stock || !category) {
    showToast('Please fill in all required fields', 'error');
    return;
  }

  const productData = {
    name,
    sku: sku || `AUTO-${Date.now()}`,
    price,
    stock,
    category,
    status,
    description,
    image: image || null,
    source: 'manual',
    stripeProductId: null,
    lastUpdated: new Date().toISOString().slice(0, 10)
  };

  if (currentEditingId) {
    // Edit existing product
    const index = inventoryProducts.findIndex(p => p.id === currentEditingId);
    if (index !== -1) {
      inventoryProducts[index] = { ...inventoryProducts[index], ...productData };
      showToast('Product updated successfully!', 'success');
    }
  } else {
    // Add new product
    const newId = Math.max(...inventoryProducts.map(p => p.id)) + 1;
    inventoryProducts.push({ id: newId, ...productData });
    showToast('Product added successfully!', 'success');
  }

  bootstrap.Modal.getInstance(document.getElementById('productModal')).hide();
  renderProducts();
  renderCharts();
}

function duplicateProduct(id) {
  const product = inventoryProducts.find(p => p.id === id);
  if (!product) return;

  const newId = Math.max(...inventoryProducts.map(p => p.id)) + 1;
  const duplicated = {
    ...product,
    id: newId,
    name: product.name + ' (Copy)',
    sku: `${product.sku}-COPY`,
    stock: 0
  };

  inventoryProducts.push(duplicated);
  showToast('Product duplicated successfully!', 'success');
  renderProducts();
  renderCharts();
}

function deleteProduct(id) {
  if (!confirm('Are you sure you want to delete this product?')) return;

  const index = inventoryProducts.findIndex(p => p.id === id);
  if (index !== -1) {
    inventoryProducts.splice(index, 1);
    showToast('Product deleted successfully!', 'success');
    renderProducts();
    renderCharts();
  }
}


// ===== BULK OPERATIONS =====
function handleBulkUpload(event) {
  const file = event.target.files[0];
  if (!file) return;

  const fileType = file.name.split('.').pop().toLowerCase();
  
  if (!['csv', 'xlsx', 'xls'].includes(fileType)) {
    showToast('Please upload a CSV or Excel file', 'error');
    return;
  }

  showToast('Processing bulk upload...', 'info');
  
  // Simulate file processing
  setTimeout(() => {
    const mockImportedProducts = [
      {
        id: Math.max(...inventoryProducts.map(p => p.id)) + 1,
        name: "Bulk Imported Item 1",
        sku: "BULK-001",
        price: 25.99,
        stock: 20,
        category: "Other",
        description: "Product imported via bulk upload",
        image: null,
        status: "active",
        source: "manual",
        stripeProductId: null,
        lastUpdated: new Date().toISOString().slice(0, 10)
      },
      {
        id: Math.max(...inventoryProducts.map(p => p.id)) + 2,
        name: "Bulk Imported Item 2",
        sku: "BULK-002",
        price: 45.50,
        stock: 5,
        category: "Food & Beverages",
        description: "Another product from bulk upload",
        image: null,
        status: "active",
        source: "manual",
        stripeProductId: null,
        lastUpdated: new Date().toISOString().slice(0, 10)
      }
    ];

    inventoryProducts.push(...mockImportedProducts);
    showToast(`Successfully imported ${mockImportedProducts.length} products!`, 'success');
    renderProducts();
    renderCharts();
  }, 3000);

  // Reset file input
  event.target.value = '';
}

function exportInventory() {
  const filtered = getFilteredAndSortedProducts();
  const csv = "Name,SKU,Price,Stock,Category,Status,Source,Description,Last Updated\n" +
    filtered.map(product => 
      `"${product.name}","${product.sku}",${product.price},${product.stock},"${product.category}","${product.status}","${product.source}","${product.description}","${product.lastUpdated}"`
    ).join('\n');

  const a = document.createElement('a');
  a.href = 'data:text/csv;charset=utf-8,' + encodeURIComponent(csv);
  a.download = `inventory-export-${new Date().toISOString().slice(0,10)}.csv`;
  a.click();
  showToast("Inventory exported successfully!", 'success', 'bi-download');
}

// ===== ENHANCED CHARTS =====
let categoryChart, stockChart, valueChart;

function renderCharts() {
  const isDarkTheme = document.documentElement.getAttribute('data-theme') === 'dark';
  const textColor = isDarkTheme ? '#fff' : '#222';
  const gridColor = isDarkTheme ? '#2b2b2b' : '#ddd';

  const filtered = getFilteredAndSortedProducts();
  
  // Category Distribution Chart
  const categories = [...new Set(filtered.map(p => p.category))];
  const categoryData = categories.map(cat => 
    filtered.filter(p => p.category === cat).length
  );

  if (categoryChart) categoryChart.destroy();
  categoryChart = new Chart(document.getElementById('categoryChart').getContext('2d'), {
    type: 'doughnut',
    data: {
      labels: categories,
      datasets: [{
        data: categoryData,
        backgroundColor: [
          '#f0b90b', '#ff6b6b', '#4ecdc4', '#45b7d1', 
          '#96ceb4', '#feca57', '#ff9ff3', '#54a0ff'
        ],
        borderWidth: 3,
        borderColor: isDarkTheme ? '#1a1a1a' : '#fff',
        hoverOffset: 8
      }]
    },
    options: {
      responsive: true,
      maintainAspectRatio: false,
      plugins: {
        legend: {
          display: true,
          position: 'bottom',
          labels: {
            color: textColor,
            font: { size: 11, weight: '600' },
            padding: 15,
            usePointStyle: true
          }
        }
      }
    }
  });

  // Stock Levels Chart
  const stockLevels = ['In Stock', 'Low Stock', 'Out of Stock'];
  const stockData = [
    filtered.filter(p => p.stock > 10).length,
    filtered.filter(p => p.stock > 0 && p.stock <= 10).length,
    filtered.filter(p => p.stock === 0).length
  ];

  if (stockChart) stockChart.destroy();
  stockChart = new Chart(document.getElementById('stockChart').getContext('2d'), {
    type: 'bar',
    data: {
      labels: stockLevels,
      datasets: [{
        label: 'Products',
        data: stockData,
        backgroundColor: ['#22c55e', '#f59e0b', '#ef4444'],
        borderWidth: 2,
        borderColor: isDarkTheme ? '#1a1a1a' : '#fff',
        borderRadius: 8
      }]
    },
    options: {
      responsive: true,
      maintainAspectRatio: false,
      plugins: {
        legend: { display: false }
      },
      scales: {
        y: {
          beginAtZero: true,
          ticks: { 
            color: textColor,
            font: { size: 11 }
          },
          grid: { 
            color: gridColor,
            drawBorder: false
          }
        },
        x: {
          ticks: { 
            color: textColor,
            font: { size: 11 }
          },
          grid: { 
            color: gridColor,
            drawBorder: false
          }
        }
      }
    }
  });

  // Value by Category Chart
  const valueData = categories.map(cat => {
    const categoryProducts = filtered.filter(p => p.category === cat);
    return categoryProducts.reduce((sum, p) => sum + (p.price * p.stock), 0);
  });

  if (valueChart) valueChart.destroy();
  valueChart = new Chart(document.getElementById('valueChart').getContext('2d'), {
    type: 'pie',
    data: {
      labels: categories,
      datasets: [{
        data: valueData,
        backgroundColor: [
          '#f0b90b', '#ff6b6b', '#4ecdc4', '#45b7d1', 
          '#96ceb4', '#feca57', '#ff9ff3', '#54a0ff'
        ],
        borderWidth: 3,
        borderColor: isDarkTheme ? '#1a1a1a' : '#fff'
      }]
    },
    options: {
      responsive: true,
      maintainAspectRatio: false,
      plugins: {
        legend: {
          display: true,
          position: 'bottom',
          labels: {
            color: textColor,
            font: { size: 11, weight: '600' },
            padding: 15,
            usePointStyle: true
          }
        },
        tooltip: {
          callbacks: {
            label: function(context) {
              const total = context.dataset.data.reduce((a, b) => a + b, 0);
              const percentage = ((context.parsed / total) * 100).toFixed(1);
              return `${context.label}: $${context.parsed.toFixed(2)} (${percentage}%)`;
            }
          }
        }
      }
    }
  });
}

// ===== ENHANCED TOASTS =====
function showToast(msg, type = 'info', icon = null) {
  const toast = document.createElement('div');
  toast.className = `toast-vbms ${type}`;
  
  const iconClass = icon || getToastIcon(type);
  toast.innerHTML = `<i class="bi ${iconClass}"></i> <span>${msg}</span>`;
  
  const container = document.getElementById('toastArea');
  container.appendChild(toast);
  
  // Animate in
  setTimeout(() => toast.classList.add('show'), 100);
  
  // Remove after 4 seconds
  setTimeout(() => {
    toast.style.animation = 'slideOutRight 0.3s ease-in forwards';
    setTimeout(() => {
      if (toast.parentNode) {
        container.removeChild(toast);
      }
    }, 300);
  }, 4000);
}

function getToastIcon(type) {
  const icons = {
    'success': 'bi-check-circle-fill',
    'error': 'bi-exclamation-triangle-fill', 
    'warning': 'bi-exclamation-circle-fill',
    'info': 'bi-info-circle-fill'
  };
  return icons[type] || 'bi-info-circle-fill';
}

// Add slideOutRight animation to CSS
const style = document.createElement('style');
style.textContent = `
  @keyframes slideOutRight {
    from {
      opacity: 1;
      transform: translateX(0);
    }
    to {
      opacity: 0;
      transform: translateX(100px);
    }
  }
`;
document.head.appendChild(style);

// ===== EVENT LISTENERS =====
document.addEventListener('DOMContentLoaded', function() {
  // Initialize
  renderProducts();
  renderCharts();

  // Add filter event listeners
  const searchInput = document.getElementById('inventorySearch');
  const categoryFilter = document.getElementById('categoryFilter');
  const stockFilter = document.getElementById('stockFilter');
  const sortBy = document.getElementById('sortBy');

  [searchInput, categoryFilter, stockFilter, sortBy].forEach(element => {
    element && element.addEventListener('input', () => {
      renderProducts();
      renderCharts();
    });
  });

  // Set initial view mode
  setViewMode('grid');
});

// Theme change listener
window.addEventListener('themeChanged', () => {
  renderCharts();
});

// Theme toggle function
function toggleTheme() {
  if (window.vbmsThemeManager) {
    window.vbmsThemeManager.toggleTheme();
  } else {
    // Fallback theme toggle
    const currentTheme = document.documentElement.getAttribute('data-theme') || 'light';
    const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
    document.documentElement.setAttribute('data-theme', newTheme);
    localStorage.setItem('vbms-theme', newTheme);
    
    // Update button icon
    const icon = document.getElementById('themeIcon');
    if (icon) {
      icon.className = newTheme === 'dark' ? 'bi bi-sun-fill' : 'bi bi-moon-fill';
    }
    
    // Re-render charts with new theme
    renderCharts();
  }
}

// Initialize theme on page load
document.addEventListener('DOMContentLoaded', function() {
  const savedTheme = localStorage.getItem('vbms-theme') || 'light';
  document.documentElement.setAttribute('data-theme', savedTheme);
  
  const icon = document.getElementById('themeIcon');
  if (icon) {
    icon.className = savedTheme === 'dark' ? 'bi bi-sun-fill' : 'bi bi-moon-fill';
  }
  
  // Load receipts on page load
  loadReceipts();
});

// ===== RECEIPT UPLOAD AND AUTO-IMPORT FUNCTIONS =====
let receipts = [];

function loadReceipts() {
  const saved = localStorage.getItem('vbms_receipts');
  if (saved) {
    receipts = JSON.parse(saved);
  }
  renderReceipts();
}

function saveReceipts() {
  localStorage.setItem('vbms_receipts', JSON.stringify(receipts));
}

function renderReceipts() {
  const tbody = document.getElementById('receiptsTableBody');
  if (!tbody) return;
  
  if (receipts.length === 0) {
    tbody.innerHTML = '<tr><td colspan="5" style="text-align: center; color: var(--text-muted); padding: 20px;">No receipts uploaded yet. Click "Upload Receipt" to get started.</td></tr>';
    return;
  }
  
  tbody.innerHTML = receipts.map(receipt => `
    <tr>
      <td>${receipt.name}</td>
      <td><span class="badge bg-info">${receipt.type.toUpperCase()}</span></td>
      <td>${(receipt.size / 1024).toFixed(2)} KB</td>
      <td>${receipt.uploadDate}</td>
      <td>
        <button class="btn btn-sm btn-outline-primary" onclick="viewReceipt(${receipt.id})" title="View">
          <i class="bi bi-eye"></i>
        </button>
        <button class="btn btn-sm btn-outline-success" onclick="downloadReceipt(${receipt.id})" title="Download">
          <i class="bi bi-download"></i>
        </button>
        <button class="btn btn-sm btn-outline-danger" onclick="deleteReceipt(${receipt.id})" title="Delete">
          <i class="bi bi-trash"></i>
        </button>
      </td>
    </tr>
  `).join('');
}

function handleReceiptUpload(event) {
  const file = event.target.files[0];
  if (!file) return;

  const fileType = file.name.split('.').pop().toLowerCase();
  const reader = new FileReader();

  reader.onload = function(e) {
    const fileContent = e.target.result;
    const newReceipt = {
      id: Date.now(),
      name: file.name,
      type: fileType,
      size: file.size,
      uploadDate: new Date().toISOString().slice(0, 10),
      content: fileContent
    };
    receipts.push(newReceipt);
    saveReceipts();
    renderReceipts();
    showToast(`Receipt "${file.name}" uploaded successfully!`, 'success');

    // Attempt to process data for inventory auto-import
    processReceiptData(fileContent, fileType);
  };

  if (fileType === 'pdf') {
    reader.readAsDataURL(file);
  } else if (['csv', 'xlsx', 'xls'].includes(fileType)) {
    reader.readAsArrayBuffer(file);
  } else {
    showToast('Unsupported file type. Please upload PDF, CSV, or Excel.', 'error');
    return;
  }
  event.target.value = '';
}

function processReceiptData(fileContent, fileType) {
  if (fileType === 'pdf') {
    showToast('PDFs cannot be auto-imported. Please add items manually.', 'info');
    return;
  }

  try {
    let workbook;
    if (fileType === 'csv') {
      workbook = XLSX.read(fileContent, { type: 'array', raw: true });
    } else {
      workbook = XLSX.read(fileContent, { type: 'array', raw: true });
    }

    const sheetName = workbook.SheetNames[0];
    const worksheet = workbook.Sheets[sheetName];
    const json = XLSX.utils.sheet_to_json(worksheet, { header: 1 });

    if (json.length < 2) {
      showToast('No data found in the uploaded file for import.', 'warning');
      return;
    }

    const headers = json[0].map(h => String(h).toLowerCase().trim());
    const dataRows = json.slice(1);
    let importedCount = 0;

    dataRows.forEach(row => {
      const productData = {};
      headers.forEach((header, index) => {
        const value = row[index];
        if (value !== undefined && value !== null) {
          if (header.includes('name')) productData.name = String(value).trim();
          if (header.includes('sku')) productData.sku = String(value).trim();
          if (header.includes('quantity') || header.includes('stock')) productData.stock = parseInt(value) || 0;
          if (header.includes('price') || header.includes('cost')) productData.price = parseFloat(value) || 0;
          if (header.includes('category')) productData.category = String(value).trim();
          if (header.includes('description') || header.includes('notes')) productData.description = String(value).trim();
          if (header.includes('image') || header.includes('url')) productData.image = String(value).trim();
        }
      });

      if (productData.name && productData.stock !== undefined && productData.price !== undefined) {
        const existingProductIndex = inventoryProducts.findIndex(p => 
          (productData.sku && p.sku === productData.sku) || p.name === productData.name
        );

        if (existingProductIndex !== -1) {
          const existingProduct = inventoryProducts[existingProductIndex];
          existingProduct.stock += productData.stock;
          existingProduct.price = productData.price;
          existingProduct.lastUpdated = new Date().toISOString().slice(0, 10);
          if (productData.category) existingProduct.category = productData.category;
          if (productData.description) existingProduct.description = productData.description;
          if (productData.image) existingProduct.image = productData.image;
          showToast(`Updated stock for "${existingProduct.name}"`, 'info');
        } else {
          const newId = Math.max(...inventoryProducts.map(p => p.id), 0) + 1;
          inventoryProducts.push({
            id: newId,
            name: productData.name,
            sku: productData.sku || `AUTO-${Date.now()}-${newId}`,
            price: productData.price,
            stock: productData.stock,
            category: productData.category || 'Other',
            description: productData.description || '',
            image: productData.image || null,
            status: 'active',
            source: 'receipt',
            stripeProductId: null,
            lastUpdated: new Date().toISOString().slice(0, 10)
          });
          showToast(`Added new product "${productData.name}" from receipt`, 'success');
        }
        importedCount++;
      }
    });

    if (importedCount > 0) {
      showToast(`Successfully imported and updated ${importedCount} products from receipt!`, 'success');
      renderProducts();
      renderCharts();
      saveInventory();
    } else {
      showToast('No valid products found in the file for import.', 'warning');
    }

  } catch (error) {
    console.error('Error processing uploaded file:', error);
    showToast('Error processing file. Please ensure it\'s correctly formatted.', 'error');
  }
}

function viewReceipt(id) {
  const receipt = receipts.find(r => r.id === id);
  if (!receipt) return;
  
  if (receipt.type === 'pdf') {
    const newWindow = window.open();
    newWindow.document.write(`<iframe src="${receipt.content}" style="width:100%;height:100%;border:none;"></iframe>`);
  } else {
    showToast('Viewing is only available for PDF files.', 'info');
  }
}

function downloadReceipt(id) {
  const receipt = receipts.find(r => r.id === id);
  if (!receipt) return;
  
  const blob = receipt.type === 'pdf' 
    ? dataURLtoBlob(receipt.content)
    : new Blob([receipt.content], { type: 'application/octet-stream' });
  
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a');
  a.href = url;
  a.download = receipt.name;
  a.click();
  URL.revokeObjectURL(url);
}

function deleteReceipt(id) {
  if (confirm('Are you sure you want to delete this receipt?')) {
    receipts = receipts.filter(r => r.id !== id);
    saveReceipts();
    renderReceipts();
    showToast('Receipt deleted successfully.', 'success');
  }
}

function dataURLtoBlob(dataURL) {
  const arr = dataURL.split(',');
  const mime = arr[0].match(/:(.*?);/)[1];
  const bstr = atob(arr[1]);
  let n = bstr.length;
  const u8arr = new Uint8Array(n);
  while (n--) {
    u8arr[n] = bstr.charCodeAt(n);
  }
  return new Blob([u8arr], { type: mime });
}

function saveInventory() {
  localStorage.setItem('vbms_inventory', JSON.stringify(inventoryProducts));
}
</script>
</body>
</html>