<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Social Media Analytics - VBMS Customer Portal</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet">
  <link href="customer-theme.css" rel="stylesheet">
  <style>
    .social-card {
      background: white;
      border-radius: 15px;
      padding: 1.5rem;
      box-shadow: 0 5px 15px rgba(0,0,0,0.1);
      transition: all 0.3s ease;
      border-top: 4px solid;
      margin-bottom: 1.5rem;
    }
    
    .social-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 10px 25px rgba(0,0,0,0.15);
    }
    
    .social-card.instagram { border-top-color: #e1306c; }
    .social-card.facebook { border-top-color: #1877f2; }
    .social-card.twitter { border-top-color: #1da1f2; }
    .social-card.google { border-top-color: #4285f4; }
    
    .metric-card {
      text-align: center;
      padding: 1rem;
      background: #f8f9fa;
      border-radius: 10px;
      margin-bottom: 1rem;
    }
    
    .metric-number {
      font-size: 2rem;
      font-weight: 700;
      color: #2c3e50;
    }
    
    .metric-label {
      color: #6c757d;
      font-size: 0.9rem;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }
    
    .growth-indicator {
      display: inline-flex;
      align-items: center;
      gap: 0.25rem;
      font-size: 0.8rem;
      font-weight: 600;
      padding: 0.25rem 0.5rem;
      border-radius: 15px;
      margin-top: 0.5rem;
    }
    
    .growth-positive {
      background: rgba(34, 197, 94, 0.1);
      color: #22c55e;
    }
    
    .growth-negative {
      background: rgba(239, 68, 68, 0.1);
      color: #ef4444;
    }
    
    .chart-container {
      background: white;
      border-radius: 15px;
      padding: 1.5rem;
      box-shadow: 0 5px 15px rgba(0,0,0,0.1);
      margin-bottom: 1.5rem;
    }
    
    .review-item {
      background: #f8f9fa;
      border-radius: 10px;
      padding: 1rem;
      margin-bottom: 1rem;
      border-left: 3px solid #ffc107;
    }
    
    .star-rating {
      color: #ffc107;
      margin-bottom: 0.5rem;
    }
    
    .engagement-bar {
      height: 8px;
      background: #e9ecef;
      border-radius: 4px;
      overflow: hidden;
      margin-top: 0.5rem;
    }
    
    .engagement-fill {
      height: 100%;
      background: linear-gradient(90deg, #22c55e, #16a34a);
      transition: width 1s ease;
    }
    
    .post-card {
      background: white;
      border-radius: 10px;
      padding: 1rem;
      margin-bottom: 1rem;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }
    
    .platform-badge {
      font-size: 0.7rem;
      padding: 0.25rem 0.5rem;
      border-radius: 10px;
      font-weight: 600;
    }
    
    .platform-instagram { background: #e1306c; color: white; }
    .platform-facebook { background: #1877f2; color: white; }
    .platform-twitter { background: #1da1f2; color: white; }
  </style>
</head>
<body>
  <!-- Sidebar -->
  <div id="sidebar-placeholder"></div>

  <!-- Main Content -->
  <div class="main-content">
    <!-- Header -->
    <div class="d-flex justify-content-between align-items-center mb-4">
      <div>
        <h1 class="h3 mb-0">Social Media Analytics</h1>
        <p class="text-muted">Track your social media performance and engagement</p>
      </div>
      <div>
        <button class="btn btn-primary" onclick="refreshStats()">
          <i class="bi bi-arrow-clockwise me-2"></i>Refresh
        </button>
      </div>
    </div>

    <!-- Social Media Overview -->
    <div class="row mb-4">
      <!-- Instagram -->
      <div class="col-lg-3 col-md-6">
        <div class="social-card instagram">
          <div class="d-flex align-items-center mb-3">
            <i class="bi bi-instagram fs-2 me-3" style="color: #e1306c;"></i>
            <div>
              <h5 class="mb-0">Instagram</h5>
              <small class="text-muted">@yourbusiness</small>
            </div>
          </div>
          <div class="metric-card">
            <div class="metric-number" id="igFollowers">12.5K</div>
            <div class="metric-label">Followers</div>
            <div class="growth-indicator growth-positive">
              <i class="bi bi-arrow-up"></i>+2.3%
            </div>
          </div>
          <div class="engagement-bar">
            <div class="engagement-fill" style="width: 78%"></div>
          </div>
          <small class="text-muted">78% Engagement Rate</small>
        </div>
      </div>

      <!-- Facebook -->
      <div class="col-lg-3 col-md-6">
        <div class="social-card facebook">
          <div class="d-flex align-items-center mb-3">
            <i class="bi bi-facebook fs-2 me-3" style="color: #1877f2;"></i>
            <div>
              <h5 class="mb-0">Facebook</h5>
              <small class="text-muted">Your Business Page</small>
            </div>
          </div>
          <div class="metric-card">
            <div class="metric-number" id="fbFollowers">8.2K</div>
            <div class="metric-label">Page Likes</div>
            <div class="growth-indicator growth-positive">
              <i class="bi bi-arrow-up"></i>+1.8%
            </div>
          </div>
          <div class="engagement-bar">
            <div class="engagement-fill" style="width: 65%"></div>
          </div>
          <small class="text-muted">65% Engagement Rate</small>
        </div>
      </div>

      <!-- X (Twitter) -->
      <div class="col-lg-3 col-md-6">
        <div class="social-card twitter">
          <div class="d-flex align-items-center mb-3">
            <i class="bi bi-twitter fs-2 me-3" style="color: #1da1f2;"></i>
            <div>
              <h5 class="mb-0">X (Twitter)</h5>
              <small class="text-muted">@yourbusiness</small>
            </div>
          </div>
          <div class="metric-card">
            <div class="metric-number" id="twitterFollowers">5.7K</div>
            <div class="metric-label">Followers</div>
            <div class="growth-indicator growth-positive">
              <i class="bi bi-arrow-up"></i>+0.5%
            </div>
          </div>
          <div class="engagement-bar">
            <div class="engagement-fill" style="width: 45%"></div>
          </div>
          <small class="text-muted">45% Engagement Rate</small>
        </div>
      </div>

      <!-- Google Reviews -->
      <div class="col-lg-3 col-md-6">
        <div class="social-card google">
          <div class="d-flex align-items-center mb-3">
            <i class="bi bi-google fs-2 me-3" style="color: #4285f4;"></i>
            <div>
              <h5 class="mb-0">Google</h5>
              <small class="text-muted">Business Reviews</small>
            </div>
          </div>
          <div class="metric-card">
            <div class="metric-number" id="googleRating">4.8</div>
            <div class="metric-label">Average Rating</div>
            <div class="star-rating">
              <i class="bi bi-star-fill"></i>
              <i class="bi bi-star-fill"></i>
              <i class="bi bi-star-fill"></i>
              <i class="bi bi-star-fill"></i>
              <i class="bi bi-star-half"></i>
            </div>
          </div>
          <small class="text-muted" id="reviewCount">142 Reviews</small>
        </div>
      </div>
    </div>

    <!-- Analytics Charts -->
    <div class="row mb-4">
      <!-- Growth Chart -->
      <div class="col-lg-8">
        <div class="chart-container">
          <h5 class="mb-3">
            <i class="bi bi-graph-up me-2"></i>
            Follower Growth (Last 30 Days)
          </h5>
          <canvas id="growthChart" height="300"></canvas>
        </div>
      </div>

      <!-- Engagement Breakdown -->
      <div class="col-lg-4">
        <div class="chart-container">
          <h5 class="mb-3">
            <i class="bi bi-pie-chart me-2"></i>
            Engagement Breakdown
          </h5>
          <canvas id="engagementChart" height="300"></canvas>
        </div>
      </div>
    </div>

    <!-- Recent Activity -->
    <div class="row">
      <!-- Top Performing Posts -->
      <div class="col-lg-6">
        <div class="card">
          <div class="card-header">
            <h5 class="mb-0">
              <i class="bi bi-fire me-2"></i>
              Top Performing Posts
            </h5>
          </div>
          <div class="card-body">
            <div id="topPosts">
              <!-- Top posts will be loaded here -->
            </div>
          </div>
        </div>
      </div>

      <!-- Recent Google Reviews -->
      <div class="col-lg-6">
        <div class="card">
          <div class="card-header">
            <h5 class="mb-0">
              <i class="bi bi-star-fill me-2 text-warning"></i>
              Recent Google Reviews
            </h5>
          </div>
          <div class="card-body">
            <div id="recentReviews">
              <!-- Reviews will be loaded here -->
            </div>
            <div class="text-center mt-3">
              <button class="btn btn-outline-primary btn-sm" onclick="requestReviews()">
                <i class="bi bi-plus-circle me-1"></i>Request More Reviews
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Social Media Insights -->
    <div class="row mt-4">
      <div class="col-12">
        <div class="card">
          <div class="card-header">
            <h5 class="mb-0">
              <i class="bi bi-lightbulb me-2"></i>
              Social Media Insights & Recommendations
            </h5>
          </div>
          <div class="card-body">
            <div class="row">
              <div class="col-md-4">
                <div class="text-center p-3 border rounded mb-3">
                  <i class="bi bi-clock-history fs-1 text-primary mb-2"></i>
                  <h6>Best Posting Time</h6>
                  <p class="text-muted mb-0">Tuesday & Thursday<br>2:00 PM - 4:00 PM</p>
                </div>
              </div>
              <div class="col-md-4">
                <div class="text-center p-3 border rounded mb-3">
                  <i class="bi bi-heart-fill fs-1 text-danger mb-2"></i>
                  <h6>Most Engaging Content</h6>
                  <p class="text-muted mb-0">Behind-the-scenes<br>& Customer stories</p>
                </div>
              </div>
              <div class="col-md-4">
                <div class="text-center p-3 border rounded mb-3">
                  <i class="bi bi-people-fill fs-1 text-success mb-2"></i>
                  <h6>Target Audience</h6>
                  <p class="text-muted mb-0">25-45 years old<br>Business professionals</p>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="load-sidebar.js"></script>
  <script src="auth.js"></script>

  <script>
    let growthChart, engagementChart;

    // Initialize the page
    document.addEventListener('DOMContentLoaded', function() {
      checkAuthAndLoadSidebar();
      loadSocialMediaData();
      initializeCharts();
      loadTopPosts();
      loadRecentReviews();
    });

    // Load social media data
    async function loadSocialMediaData() {
      try {
        // In real implementation, this would fetch from your backend API
        // which would aggregate data from various social media APIs
        const data = await fetchSocialMediaData();
        updateDashboard(data);
      } catch (error) {
        console.error('Error loading social media data:', error);
        showDemoData();
      }
    }

    // Fetch social media data (placeholder)
    async function fetchSocialMediaData() {
      // This would integrate with your backend API that connects to:
      // - Instagram Basic Display API
      // - Facebook Graph API
      // - Twitter API v2
      // - Google My Business API
      
      return {
        instagram: { followers: 12543, growth: 2.3, engagement: 78 },
        facebook: { followers: 8234, growth: 1.8, engagement: 65 },
        twitter: { followers: 5678, growth: 0.5, engagement: 45 },
        google: { rating: 4.8, reviews: 142 }
      };
    }

    // Show demo data
    function showDemoData() {
      const demoData = {
        instagram: { followers: 12543, growth: 2.3, engagement: 78 },
        facebook: { followers: 8234, growth: 1.8, engagement: 65 },
        twitter: { followers: 5678, growth: 0.5, engagement: 45 },
        google: { rating: 4.8, reviews: 142 }
      };
      updateDashboard(demoData);
    }

    // Update dashboard with data
    function updateDashboard(data) {
      document.getElementById('igFollowers').textContent = formatNumber(data.instagram.followers);
      document.getElementById('fbFollowers').textContent = formatNumber(data.facebook.followers);
      document.getElementById('twitterFollowers').textContent = formatNumber(data.twitter.followers);
      document.getElementById('googleRating').textContent = data.google.rating;
      document.getElementById('reviewCount').textContent = `${data.google.reviews} Reviews`;
    }

    // Initialize charts
    function initializeCharts() {
      initializeGrowthChart();
      initializeEngagementChart();
    }

    // Initialize growth chart
    function initializeGrowthChart() {
      const ctx = document.getElementById('growthChart').getContext('2d');
      growthChart = new Chart(ctx, {
        type: 'line',
        data: {
          labels: ['Week 1', 'Week 2', 'Week 3', 'Week 4'],
          datasets: [
            {
              label: 'Instagram',
              data: [12000, 12200, 12350, 12543],
              borderColor: '#e1306c',
              backgroundColor: 'rgba(225, 48, 108, 0.1)',
              tension: 0.4,
              fill: true
            },
            {
              label: 'Facebook',
              data: [8000, 8100, 8180, 8234],
              borderColor: '#1877f2',
              backgroundColor: 'rgba(24, 119, 242, 0.1)',
              tension: 0.4,
              fill: true
            },
            {
              label: 'Twitter',
              data: [5500, 5580, 5620, 5678],
              borderColor: '#1da1f2',
              backgroundColor: 'rgba(29, 161, 242, 0.1)',
              tension: 0.4,
              fill: true
            }
          ]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          plugins: {
            legend: {
              position: 'top'
            }
          },
          scales: {
            y: {
              beginAtZero: false
            }
          }
        }
      });
    }

    // Initialize engagement chart
    function initializeEngagementChart() {
      const ctx = document.getElementById('engagementChart').getContext('2d');
      engagementChart = new Chart(ctx, {
        type: 'doughnut',
        data: {
          labels: ['Likes', 'Comments', 'Shares', 'Saves'],
          datasets: [{
            data: [45, 25, 20, 10],
            backgroundColor: [
              '#e1306c',
              '#1877f2',
              '#1da1f2',
              '#22c55e'
            ],
            borderWidth: 0
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          plugins: {
            legend: {
              position: 'bottom'
            }
          }
        }
      });
    }

    // Load top performing posts
    function loadTopPosts() {
      const container = document.getElementById('topPosts');
      const topPosts = [
        {
          platform: 'Instagram',
          content: 'Behind the scenes of our latest project! 🚀',
          engagement: { likes: 234, comments: 18, shares: 12 },
          performance: 'High'
        },
        {
          platform: 'Facebook',
          content: 'Customer success story: How we helped increase their revenue by 150%',
          engagement: { likes: 156, comments: 23, shares: 31 },
          performance: 'High'
        },
        {
          platform: 'Twitter',
          content: '5 tips for growing your business in 2024 🧵',
          engagement: { likes: 89, comments: 12, shares: 45 },
          performance: 'Medium'
        }
      ];

      container.innerHTML = topPosts.map(post => `
        <div class="post-card">
          <div class="d-flex justify-content-between align-items-start mb-2">
            <span class="platform-badge platform-${post.platform.toLowerCase()}">${post.platform}</span>
            <span class="badge ${post.performance === 'High' ? 'bg-success' : 'bg-warning'}">${post.performance}</span>
          </div>
          <p class="mb-2">${post.content}</p>
          <div class="d-flex gap-3 small text-muted">
            <span><i class="bi bi-heart"></i> ${post.engagement.likes}</span>
            <span><i class="bi bi-chat"></i> ${post.engagement.comments}</span>
            <span><i class="bi bi-share"></i> ${post.engagement.shares}</span>
          </div>
        </div>
      `).join('');
    }

    // Load recent reviews
    function loadRecentReviews() {
      const container = document.getElementById('recentReviews');
      const reviews = [
        {
          author: 'Sarah Johnson',
          rating: 5,
          text: 'Excellent service! The team was very professional and delivered exactly what we needed.',
          date: '2 days ago'
        },
        {
          author: 'Mike Chen',
          rating: 5,
          text: 'Outstanding quality and great communication throughout the project.',
          date: '1 week ago'
        },
        {
          author: 'Lisa Rodriguez',
          rating: 4,
          text: 'Very satisfied with the results. Would definitely recommend!',
          date: '2 weeks ago'
        }
      ];

      container.innerHTML = reviews.map(review => `
        <div class="review-item">
          <div class="d-flex justify-content-between align-items-start mb-2">
            <strong>${review.author}</strong>
            <small class="text-muted">${review.date}</small>
          </div>
          <div class="star-rating mb-2">
            ${generateStars(review.rating)}
          </div>
          <p class="mb-0 small">${review.text}</p>
        </div>
      `).join('');
    }

    // Generate star rating
    function generateStars(rating) {
      let stars = '';
      for (let i = 1; i <= 5; i++) {
        if (i <= rating) {
          stars += '<i class="bi bi-star-fill"></i>';
        } else if (i - 0.5 <= rating) {
          stars += '<i class="bi bi-star-half"></i>';
        } else {
          stars += '<i class="bi bi-star"></i>';
        }
      }
      return stars;
    }

    // Format numbers
    function formatNumber(num) {
      if (num >= 1000000) {
        return (num / 1000000).toFixed(1) + 'M';
      }
      if (num >= 1000) {
        return (num / 1000).toFixed(1) + 'K';
      }
      return num.toString();
    }

    // Refresh stats
    function refreshStats() {
      loadSocialMediaData();
      loadTopPosts();
      loadRecentReviews();
      showNotification('Social media stats refreshed!', 'success');
    }

    // Request more reviews
    function requestReviews() {
      showNotification('Review request feature coming soon!', 'info');
    }

    // Show notification
    function showNotification(message, type) {
      // You can integrate with your existing notification system
      const alert = document.createElement('div');
      alert.className = `alert alert-${type} alert-dismissible fade show position-fixed`;
      alert.style.top = '20px';
      alert.style.right = '20px';
      alert.style.zIndex = '9999';
      alert.innerHTML = `
        ${message}
        <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
      `;
      document.body.appendChild(alert);
      
      setTimeout(() => {
        if (alert.parentNode) {
          alert.parentNode.removeChild(alert);
        }
      }, 3000);
    }
  </script>
</body>
</html>
