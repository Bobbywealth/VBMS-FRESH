<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VBMS Login Debug</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="bg-light">
    <div class="container mt-5">
        <div class="row justify-content-center">
            <div class="col-md-6">
                <div class="card">
                    <div class="card-header">
                        <h4>ðŸ”§ VBMS Login Debug Tool</h4>
                    </div>
                    <div class="card-body">
                        <button class="btn btn-primary mb-3" onclick="checkAuthState()">Check Auth State</button>
                        <button class="btn btn-success mb-3" onclick="setMainAdminAuth()">Set Main Admin Auth</button>
                        <button class="btn btn-warning mb-3" onclick="clearAuth()">Clear Auth</button>
                        <button class="btn btn-info mb-3" onclick="testRedirect()">Test Redirect</button>
                        
                        <div id="debugOutput" class="mt-4 p-3 bg-dark text-light rounded" style="font-family: monospace; white-space: pre-wrap; height: 400px; overflow-y: auto;"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="auth.js"></script>
    <script>
        function log(message) {
            const output = document.getElementById('debugOutput');
            const timestamp = new Date().toLocaleTimeString();
            output.textContent += `[${timestamp}] ${message}\n`;
            output.scrollTop = output.scrollHeight;
        }

        function checkAuthState() {
            log('=== CHECKING AUTH STATE ===');
            log('vbmsToken: ' + localStorage.getItem('vbmsToken'));
            log('vbmsUser: ' + localStorage.getItem('vbmsUser'));
            log('vbmsRole: ' + localStorage.getItem('vbmsRole'));
            log('vbmsLoggedIn: ' + localStorage.getItem('vbmsLoggedIn'));
            
            if (typeof vbmsAuth !== 'undefined') {
                log('vbmsAuth.isLoggedIn(): ' + vbmsAuth.isLoggedIn());
                log('vbmsAuth.getCurrentRole(): ' + vbmsAuth.getCurrentRole());
                log('vbmsAuth.isMainAdmin(): ' + vbmsAuth.isMainAdmin());
                log('vbmsAuth.getCurrentUser(): ' + JSON.stringify(vbmsAuth.getCurrentUser()));
            } else {
                log('ERROR: vbmsAuth not loaded!');
            }
        }

        function setMainAdminAuth() {
            log('=== SETTING MAIN ADMIN AUTH ===');
            const mainAdminData = {
                id: 'main_admin_1',
                name: 'Bobby Admin',
                email: 'BobbyAdmin@vbms.com',
                role: 'main_admin',
                position: 'Founder'
            };
            
            localStorage.setItem('vbmsToken', 'temp_main_admin_token');
            localStorage.setItem('vbmsUser', JSON.stringify(mainAdminData));
            localStorage.setItem('vbmsRole', 'main_admin');
            localStorage.setItem('vbmsLoggedIn', 'true');
            localStorage.setItem('vbmsLoginTime', new Date().toISOString());
            localStorage.setItem('token', 'temp_main_admin_token');
            
            log('Main admin auth set successfully!');
            checkAuthState();
        }

        function clearAuth() {
            log('=== CLEARING AUTH ===');
            localStorage.removeItem('vbmsToken');
            localStorage.removeItem('vbmsUser');
            localStorage.removeItem('vbmsRole');
            localStorage.removeItem('vbmsLoggedIn');
            localStorage.removeItem('vbmsLoginTime');
            localStorage.removeItem('token');
            log('Auth cleared!');
        }

        function testRedirect() {
            log('=== TESTING REDIRECT LOGIC ===');
            checkAuthState();
            
            if (typeof vbmsAuth !== 'undefined' && vbmsAuth.isLoggedIn()) {
                const role = vbmsAuth.getCurrentRole();
                log('Current role: ' + role);
                
                if (role === 'main_admin') {
                    log('Should redirect to: admin-main-dashboard.html');
                    setTimeout(() => {
                        window.location.href = 'admin-main-dashboard.html';
                    }, 2000);
                } else {
                    log('Should redirect to: dashboard.html');
                    setTimeout(() => {
                        window.location.href = 'dashboard.html';
                    }, 2000);
                }
            } else {
                log('Not logged in - should redirect to login.html');
            }
        }

        // Auto-check auth state on load
        setTimeout(() => {
            log('=== PAGE LOADED ===');
            checkAuthState();
        }, 500);
    </script>
</body>
</html>
