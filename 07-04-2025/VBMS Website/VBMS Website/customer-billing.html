<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Billing & Payments - VBMS Customer Dashboard</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://unpkg.com/bootstrap-icons@1.11.3/font/bootstrap-icons.css">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
  <script src="config.js"></script>
  <script src="navigation-enforcement.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  
  <style>
    :root {
        --accent: #f0b90b;
        --accent-light: #ffd700;
        --accent-glow: rgba(240, 185, 11, 0.4);
        --primary-dark: #d4a109;
        --secondary: #2c3e50;
        --success: #22c55e;
        --danger: #ef4444;
        --warning: #f59e0b;
        --info: #3b82f6;
        --purple: #a855f7;
        --cyan: #06b6d4;
        --light: #f8f9fa;
        --dark: #212529;
        --glass: rgba(255,255,255,0.95);
        --glass-glow: rgba(240, 185, 11, 0.15);
        --border: #e9ecef;
        --text: #212529;
        --text-muted: #6c757d;
        --card-bg: #ffffff;
        --card-shadow: 0 8px 32px rgba(240, 185, 11, 0.1);
        --bg: linear-gradient(135deg, #f8f9fa 0%, #f0f8ff 50%, #f8f4ff 100%);
    }

    /* Dark theme - Modern Black/Gray with Energy */
    [data-theme="dark"] {
        --bg: linear-gradient(135deg, #000000 0%, #0a0a0a 25%, #1a1a1a 50%, #0f0f0f 100%);
        --light: #ffffff;
        --dark: #000000;
        --text: #ffffff;
        --text-muted: #a1a1aa;
        --card-bg: rgba(20, 20, 20, 0.95);
        --card-shadow: 0 8px 32px rgba(0, 0, 0, 0.8), 0 0 20px rgba(240, 185, 11, 0.15);
        --border: rgba(64, 64, 64, 0.4);
        --glass: rgba(18, 18, 18, 0.95);
        --glass-glow: rgba(240, 185, 11, 0.2);
        --accent: #f0b90b;
        --accent-light: #ffd700;
        --success: #22c55e;
        --danger: #ef4444;
        --warning: #f59e0b;
        --info: #3b82f6;
        --purple: #a855f7;
        --cyan: #06b6d4;
    }

    * { margin: 0; padding: 0; box-sizing: border-box; }
    
    body {
        font-family: 'Inter', sans-serif;
        background: var(--bg);
        color: var(--text);
        overflow-x: hidden;
        transition: all 0.3s ease;
        position: relative;
        min-height: 100vh;
    }

    /* Enhanced Background Animation */
    body::before {
        content: '';
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        z-index: -2;
        background: 
            radial-gradient(circle at 20% 30%, rgba(240, 185, 11, 0.08) 0%, transparent 50%),
            radial-gradient(circle at 80% 70%, rgba(59, 130, 246, 0.05) 0%, transparent 50%),
            radial-gradient(circle at 50% 50%, rgba(168, 85, 247, 0.03) 0%, transparent 60%);
        animation: enhancedGlow 25s ease-in-out infinite;
    }

    [data-theme="dark"] body::before {
        background: 
            radial-gradient(circle at 20% 30%, rgba(240, 185, 11, 0.12) 0%, transparent 50%),
            radial-gradient(circle at 80% 70%, rgba(59, 130, 246, 0.08) 0%, transparent 50%),
            radial-gradient(circle at 50% 50%, rgba(168, 85, 247, 0.06) 0%, transparent 60%);
    }

    @keyframes enhancedGlow {
        0%, 100% {
            opacity: 0.6;
            transform: rotate(0deg) scale(1);
        }
        33% {
            opacity: 0.8;
            transform: rotate(120deg) scale(1.05);
        }
        66% {
            opacity: 0.7;
            transform: rotate(240deg) scale(0.95);
        }
    }

    .main {
        margin-left: 320px;
        padding: 30px;
        min-height: 100vh;
        transition: margin-left 0.3s ease;
    }

    /* Header Styles */
    .page-header {
        background: var(--card-bg);
        backdrop-filter: blur(20px);
        border: 1px solid var(--border);
        border-radius: 20px;
        padding: 30px;
        margin-bottom: 30px;
        box-shadow: var(--card-shadow);
        position: relative;
        overflow: hidden;
    }

    .page-header::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        height: 4px;
        background: linear-gradient(90deg, var(--accent), var(--accent-light), var(--info), var(--purple));
    }

    .page-header h1 {
        color: var(--accent);
        font-weight: 800;
        font-size: 2.5rem;
        margin: 0;
        text-shadow: 0 2px 4px rgba(240, 185, 11, 0.3);
    }

    .page-subtitle {
        color: var(--text-muted);
        font-size: 1.1rem;
        margin: 8px 0 0 0;
        font-weight: 400;
    }

    /* Stats Grid */
    .stats-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
        gap: 20px;
        margin-bottom: 30px;
    }

    .stat-card {
        background: var(--card-bg);
        backdrop-filter: blur(20px);
        border: 1px solid var(--border);
        border-radius: 16px;
        padding: 24px;
        transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        box-shadow: var(--card-shadow);
        position: relative;
        overflow: hidden;
    }

    .stat-card::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        height: 4px;
        background: linear-gradient(90deg, var(--accent), var(--accent-light));
        transform: scaleX(0);
        transition: transform 0.3s ease;
    }

    .stat-card:hover {
        transform: translateY(-4px) scale(1.02);
        box-shadow: 0 15px 35px rgba(240, 185, 11, 0.2);
    }

    .stat-card:hover::before {
        transform: scaleX(1);
    }

    .stat-header {
        display: flex;
        justify-content: space-between;
        align-items: flex-start;
        margin-bottom: 16px;
    }

    .stat-icon {
        width: 60px;
        height: 60px;
        border-radius: 16px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 1.5rem;
        background: var(--glass-glow);
        color: var(--accent);
        box-shadow: 0 8px 20px rgba(240, 185, 11, 0.2);
    }

    .stat-number {
        font-size: 2.2rem;
        font-weight: 800;
        color: var(--accent);
        margin-bottom: 8px;
        text-shadow: 0 2px 4px rgba(240, 185, 11, 0.3);
    }

    .stat-label {
        font-size: 0.875rem;
        color: var(--text-muted);
        text-transform: uppercase;
        font-weight: 600;
        letter-spacing: 0.5px;
        margin-bottom: 12px;
    }

    .stat-trend {
        display: flex;
        align-items: center;
        gap: 4px;
        font-size: 0.75rem;
        font-weight: 600;
    }

    .trend-up { color: var(--success); }
    .trend-down { color: var(--danger); }
    .trend-neutral { color: var(--text-muted); }

    /* Card Styles */
    .billing-card {
        background: var(--card-bg);
        backdrop-filter: blur(20px);
        border: 1px solid var(--border);
        border-radius: 20px;
        padding: 30px;
        margin-bottom: 30px;
        box-shadow: var(--card-shadow);
        transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        position: relative;
        overflow: hidden;
    }

    .billing-card::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        height: 4px;
        background: linear-gradient(90deg, var(--accent), var(--accent-light));
    }

    .billing-card:hover {
        transform: translateY(-2px);
        box-shadow: 0 12px 30px rgba(240, 185, 11, 0.15);
    }

    .card-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 25px;
        padding-bottom: 15px;
        border-bottom: 1px solid var(--border);
    }

    .card-title {
        color: var(--accent);
        font-size: 1.5rem;
        font-weight: 700;
        margin: 0;
        display: flex;
        align-items: center;
        gap: 10px;
    }

    /* Current Plan Card */
    .plan-badge {
        display: inline-flex;
        align-items: center;
        gap: 8px;
        padding: 8px 16px;
        border-radius: 25px;
        font-size: 0.875rem;
        font-weight: 600;
        text-transform: uppercase;
        letter-spacing: 0.5px;
    }

    .plan-premium {
        background: linear-gradient(135deg, var(--accent), var(--accent-light));
        color: #000;
        box-shadow: 0 4px 15px rgba(240, 185, 11, 0.3);
    }

    .plan-basic {
        background: var(--info);
        color: white;
        box-shadow: 0 4px 15px rgba(59, 130, 246, 0.3);
    }

    .plan-features {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 15px;
        margin-top: 20px;
    }

    .feature-item {
        display: flex;
        align-items: center;
        gap: 10px;
        padding: 10px;
        background: var(--glass-glow);
        border-radius: 10px;
        transition: all 0.3s ease;
    }

    .feature-item:hover {
        background: rgba(240, 185, 11, 0.2);
        transform: translateX(5px);
    }

    .feature-icon {
        color: var(--success);
        font-size: 1.1rem;
    }

    /* Payment Method Card */
    .payment-method {
        display: flex;
        align-items: center;
        justify-content: space-between;
        padding: 20px;
        background: var(--glass);
        border: 1px solid var(--border);
        border-radius: 15px;
        margin-bottom: 15px;
        transition: all 0.3s ease;
    }

    .payment-method:hover {
        background: var(--glass-glow);
        transform: translateX(5px);
        box-shadow: 0 5px 15px rgba(240, 185, 11, 0.1);
    }

    .payment-info {
        display: flex;
        align-items: center;
        gap: 15px;
    }

    .payment-icon {
        width: 50px;
        height: 35px;
        border-radius: 8px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 1.2rem;
        color: white;
    }

    .payment-visa { background: linear-gradient(135deg, #1e3a8a, #3b82f6); }
    .payment-mastercard { background: linear-gradient(135deg, #dc2626, #f87171); }
    .payment-paypal { background: linear-gradient(135deg, #1e40af, #3b82f6); }

    .payment-details h5 {
        margin: 0 0 5px 0;
        color: var(--text);
        font-weight: 600;
    }

    .payment-details p {
        margin: 0;
        color: var(--text-muted);
        font-size: 0.875rem;
    }

    .default-badge {
        background: var(--success);
        color: white;
        padding: 4px 12px;
        border-radius: 15px;
        font-size: 0.75rem;
        font-weight: 600;
    }

    /* Transaction History */
    .transaction-item {
        display: flex;
        align-items: center;
        justify-content: space-between;
        padding: 20px;
        background: var(--glass);
        border: 1px solid var(--border);
        border-radius: 15px;
        margin-bottom: 15px;
        transition: all 0.3s ease;
    }

    .transaction-item:hover {
        background: var(--glass-glow);
        transform: translateX(5px);
        box-shadow: 0 5px 15px rgba(240, 185, 11, 0.1);
    }

    .transaction-left {
        display: flex;
        align-items: center;
        gap: 15px;
    }

    .transaction-icon {
        width: 45px;
        height: 45px;
        border-radius: 12px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 1.2rem;
    }

    .transaction-success { background: rgba(34, 197, 94, 0.1); color: var(--success); }
    .transaction-pending { background: rgba(245, 158, 11, 0.1); color: var(--warning); }
    .transaction-failed { background: rgba(239, 68, 68, 0.1); color: var(--danger); }

    .transaction-details h6 {
        margin: 0 0 5px 0;
        color: var(--text);
        font-weight: 600;
    }

    .transaction-details p {
        margin: 0;
        color: var(--text-muted);
        font-size: 0.875rem;
    }

    .transaction-amount {
        text-align: right;
    }

    .amount {
        font-size: 1.1rem;
        font-weight: 700;
        color: var(--text);
        margin-bottom: 5px;
    }

    .status-badge {
        padding: 4px 12px;
        border-radius: 15px;
        font-size: 0.75rem;
        font-weight: 600;
        text-transform: uppercase;
    }

    .status-success { background: rgba(34, 197, 94, 0.1); color: var(--success); }
    .status-pending { background: rgba(245, 158, 11, 0.1); color: var(--warning); }
    .status-failed { background: rgba(239, 68, 68, 0.1); color: var(--danger); }

    /* Buttons */
    .btn-action {
        padding: 10px 20px;
        border: none;
        border-radius: 10px;
        font-size: 0.875rem;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        display: inline-flex;
        align-items: center;
        gap: 8px;
        text-decoration: none;
    }

    .btn-primary {
        background: var(--accent);
        color: #000;
        box-shadow: 0 4px 15px rgba(240, 185, 11, 0.3);
    }

    .btn-primary:hover {
        background: var(--accent-light);
        transform: translateY(-2px);
        box-shadow: 0 6px 20px rgba(240, 185, 11, 0.4);
        color: #000;
        text-decoration: none;
    }

    .btn-secondary {
        background: transparent;
        color: var(--accent);
        border: 1px solid var(--accent);
    }

    .btn-secondary:hover {
        background: var(--glass-glow);
        transform: translateY(-2px);
        box-shadow: 0 4px 15px rgba(240, 185, 11, 0.2);
        color: var(--accent);
        text-decoration: none;
    }

    .btn-success {
        background: var(--success);
        color: white;
        box-shadow: 0 4px 15px rgba(34, 197, 94, 0.3);
    }

    .btn-success:hover {
        background: #16a34a;
        transform: translateY(-2px);
        box-shadow: 0 6px 20px rgba(34, 197, 94, 0.4);
        color: white;
        text-decoration: none;
    }

    /* Chart Container */
    .chart-container {
        position: relative;
        height: 300px;
        background: var(--glass);
        border-radius: 15px;
        padding: 20px;
        margin-top: 20px;
    }

    /* Modal Styles */
    .modal-overlay {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.8);
        backdrop-filter: blur(5px);
        display: flex;
        align-items: center;
        justify-content: center;
        z-index: 10000;
        opacity: 0;
        transition: opacity 0.3s ease;
    }

    .modal-overlay.show {
        opacity: 1;
    }

    .modal {
        background: var(--card-bg);
        backdrop-filter: blur(20px);
        border: 1px solid var(--border);
        border-radius: 20px;
        padding: 30px;
        width: 90%;
        max-width: 500px;
        max-height: 85vh;
        overflow-y: auto;
        box-shadow: 0 25px 50px rgba(0, 0, 0, 0.5);
        transform: scale(0.9) translateY(20px);
        transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        position: relative;
    }

    .modal-overlay.show .modal {
        transform: scale(1) translateY(0);
    }

    .modal::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        height: 4px;
        background: linear-gradient(90deg, var(--accent), var(--accent-light), var(--info), var(--purple));
        border-radius: 20px 20px 0 0;
    }

    .modal-header {
        display: flex;
        align-items: center;
        justify-content: space-between;
        margin-bottom: 25px;
        padding-bottom: 15px;
        border-bottom: 1px solid var(--border);
    }

    .modal h3 {
        color: var(--accent);
        margin: 0;
        font-weight: 700;
        font-size: 1.5rem;
        display: flex;
        align-items: center;
        gap: 10px;
    }

    .modal-close {
        background: none;
        border: none;
        color: var(--text-muted);
        font-size: 1.5rem;
        cursor: pointer;
        padding: 5px;
        border-radius: 50%;
        transition: all 0.3s ease;
        display: flex;
        align-items: center;
        justify-content: center;
    }

    .modal-close:hover {
        background: var(--glass-glow);
        color: var(--accent);
        transform: scale(1.1);
    }

    .form-group {
        margin-bottom: 20px;
    }

    .form-group label {
        display: block;
        margin-bottom: 8px;
        color: var(--text);
        font-weight: 600;
        font-size: 0.875rem;
    }

    .form-group input,
    .form-group select {
        width: 100%;
        padding: 12px 15px;
        border: 1px solid var(--border);
        border-radius: 10px;
        background: var(--glass);
        color: var(--text);
        font-size: 0.875rem;
        transition: all 0.3s ease;
        font-family: 'Inter', sans-serif;
    }

    .form-group input:focus,
    .form-group select:focus {
        outline: none;
        border-color: var(--accent);
        box-shadow: 0 0 0 3px rgba(240, 185, 11, 0.1);
    }

    .modal-actions {
        display: flex;
        gap: 12px;
        justify-content: flex-end;
        margin-top: 25px;
        padding-top: 20px;
        border-top: 1px solid var(--border);
    }

    /* Mobile Responsive */
    @media (max-width: 1024px) {
        .main {
            margin-left: 280px;
        }

        .stats-grid {
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
        }
    }

    @media (max-width: 768px) {
        .main {
            margin-left: 0;
            padding: 80px 15px 20px;
        }

        .page-header {
            padding: 20px;
            text-align: center;
        }

        .page-header h1 {
            font-size: 2rem;
        }

        .stats-grid {
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
        }

        .stat-card {
            padding: 20px;
        }

        .stat-number {
            font-size: 1.8rem;
        }

        .billing-card {
            padding: 20px;
        }

        .plan-features {
            grid-template-columns: 1fr;
        }

        .transaction-item,
        .payment-method {
            flex-direction: column;
            align-items: flex-start;
            gap: 15px;
        }

        .transaction-amount {
            text-align: left;
            align-self: flex-end;
        }

        .modal {
            width: 95%;
            padding: 25px 20px;
            max-height: 90vh;
        }

        .modal-actions {
            flex-direction: column-reverse;
        }
    }

    @media (max-width: 480px) {
        .main {
            padding: 70px 10px 15px;
        }

        .page-header h1 {
            font-size: 1.75rem;
        }

        .stats-grid {
            grid-template-columns: 1fr;
        }

        .stat-card {
            padding: 15px;
        }

        .billing-card {
            padding: 15px;
        }

        .btn-action {
            font-size: 0.8rem;
            padding: 8px 16px;
        }

        .modal {
            padding: 20px 15px;
        }
    }
  </style>
</head>
<body>
  <!-- Sidebar Container -->
  <div id="sidebar-container"></div>

  <!-- Main Content -->
  <main class="main">
    <!-- Page Header -->
    <div class="page-header">
      <h1><i class="bi bi-credit-card-2-front"></i> Billing & Payments</h1>
      <p class="page-subtitle">Manage your subscription, payments, and billing information</p>
    </div>

    <!-- Stats Grid -->
    <div class="stats-grid">
      <div class="stat-card">
        <div class="stat-header">
          <div>
            <div class="stat-number" id="monthlySpending">$299.99</div>
            <div class="stat-label">Monthly Spending</div>
            <div class="stat-trend trend-neutral">
              <i class="bi bi-dash"></i> Same as last month
            </div>
          </div>
          <div class="stat-icon">
            <i class="bi bi-currency-dollar"></i>
          </div>
        </div>
      </div>
      
      <div class="stat-card">
        <div class="stat-header">
          <div>
            <div class="stat-number" id="nextPayment">Feb 15</div>
            <div class="stat-label">Next Payment</div>
            <div class="stat-trend trend-up">
              <i class="bi bi-calendar-check"></i> In 15 days
            </div>
          </div>
          <div class="stat-icon">
            <i class="bi bi-calendar-event"></i>
          </div>
        </div>
      </div>
      
      <div class="stat-card">
        <div class="stat-header">
          <div>
            <div class="stat-number" id="totalTransactions">24</div>
            <div class="stat-label">Total Transactions</div>
            <div class="stat-trend trend-up">
              <i class="bi bi-arrow-up"></i> +3 this month
            </div>
          </div>
          <div class="stat-icon">
            <i class="bi bi-receipt"></i>
          </div>
        </div>
      </div>
      
      <div class="stat-card">
        <div class="stat-header">
          <div>
            <div class="stat-number" id="savedAmount">$1,248</div>
            <div class="stat-label">Total Saved</div>
            <div class="stat-trend trend-up">
              <i class="bi bi-arrow-up"></i> +$127 this year
            </div>
          </div>
          <div class="stat-icon">
            <i class="bi bi-piggy-bank"></i>
          </div>
        </div>
      </div>
    </div>

    <!-- Current Plan -->
    <div class="billing-card">
      <div class="card-header">
        <h3 class="card-title">
          <i class="bi bi-star-fill"></i>
          Current Plan
        </h3>
        <div class="plan-badge plan-premium">
          <i class="bi bi-crown-fill"></i>
          Premium Plan
        </div>
      </div>
      
      <div class="row">
        <div class="col-md-6">
          <h4>Premium Plan - $299.99/month</h4>
          <p class="text-muted mb-3">All features included with priority support</p>
          <p><strong>Next billing date:</strong> February 15, 2025</p>
          <p><strong>Billing cycle:</strong> Monthly</p>
        </div>
        <div class="col-md-6">
          <div class="d-flex gap-2 mb-3">
            <button class="btn-action btn-secondary" onclick="changePlan()">
              <i class="bi bi-arrow-up-right-square"></i>
              Change Plan
            </button>
            <button class="btn-action btn-secondary" onclick="cancelSubscription()">
              <i class="bi bi-x-circle"></i>
              Cancel Subscription
            </button>
          </div>
        </div>
      </div>

      <div class="plan-features">
        <div class="feature-item">
          <i class="bi bi-check-circle-fill feature-icon"></i>
          <span>Unlimited Orders Processing</span>
        </div>
        <div class="feature-item">
          <i class="bi bi-check-circle-fill feature-icon"></i>
          <span>Advanced Analytics Dashboard</span>
        </div>
        <div class="feature-item">
          <i class="bi bi-check-circle-fill feature-icon"></i>
          <span>Multi-Platform Integration</span>
        </div>
        <div class="feature-item">
          <i class="bi bi-check-circle-fill feature-icon"></i>
          <span>Priority Customer Support</span>
        </div>
        <div class="feature-item">
          <i class="bi bi-check-circle-fill feature-icon"></i>
          <span>Advanced Inventory Management</span>
        </div>
        <div class="feature-item">
          <i class="bi bi-check-circle-fill feature-icon"></i>
          <span>Custom Reporting Tools</span>
        </div>
      </div>
    </div>

    <!-- Payment Methods -->
    <div class="billing-card">
      <div class="card-header">
        <h3 class="card-title">
          <i class="bi bi-credit-card"></i>
          Payment Methods
        </h3>
        <button class="btn-action btn-primary" onclick="addPaymentMethod()">
          <i class="bi bi-plus-circle"></i>
          Add Payment Method
        </button>
      </div>

      <div class="payment-method">
        <div class="payment-info">
          <div class="payment-icon payment-visa">
            <i class="bi bi-credit-card-fill"></i>
          </div>
          <div class="payment-details">
            <h5>Visa ending in 4242</h5>
            <p>Expires 12/2027</p>
          </div>
          <span class="default-badge">Default</span>
        </div>
        <div class="d-flex gap-2">
          <button class="btn-action btn-secondary" onclick="editPaymentMethod('pm_1')">Edit</button>
          <button class="btn-action btn-secondary" onclick="deletePaymentMethod('pm_1')">Remove</button>
        </div>
      </div>

      <div class="payment-method">
        <div class="payment-info">
          <div class="payment-icon payment-paypal">
            <i class="bi bi-paypal"></i>
          </div>
          <div class="payment-details">
            <h5>PayPal Account</h5>
            <p>user@example.com</p>
          </div>
        </div>
        <div class="d-flex gap-2">
          <button class="btn-action btn-secondary" onclick="setDefaultPayment('pm_2')">Set Default</button>
          <button class="btn-action btn-secondary" onclick="deletePaymentMethod('pm_2')">Remove</button>
        </div>
      </div>
    </div>

    <!-- Recent Transactions -->
    <div class="billing-card">
      <div class="card-header">
        <h3 class="card-title">
          <i class="bi bi-receipt"></i>
          Recent Transactions
        </h3>
        <button class="btn-action btn-secondary" onclick="viewAllTransactions()">
          <i class="bi bi-list"></i>
          View All
        </button>
      </div>

      <div class="transaction-item">
        <div class="transaction-left">
          <div class="transaction-icon transaction-success">
            <i class="bi bi-check-circle-fill"></i>
          </div>
          <div class="transaction-details">
            <h6>Premium Plan Subscription</h6>
            <p>January 15, 2025 • Visa ****4242</p>
          </div>
        </div>
        <div class="transaction-amount">
          <div class="amount">$299.99</div>
          <span class="status-badge status-success">Paid</span>
        </div>
      </div>

      <div class="transaction-item">
        <div class="transaction-left">
          <div class="transaction-icon transaction-success">
            <i class="bi bi-check-circle-fill"></i>
          </div>
          <div class="transaction-details">
            <h6>Premium Plan Subscription</h6>
            <p>December 15, 2024 • Visa ****4242</p>
          </div>
        </div>
        <div class="transaction-amount">
          <div class="amount">$299.99</div>
          <span class="status-badge status-success">Paid</span>
        </div>
      </div>

      <div class="transaction-item">
        <div class="transaction-left">
          <div class="transaction-icon transaction-success">
            <i class="bi bi-check-circle-fill"></i>
          </div>
          <div class="transaction-details">
            <h6>Premium Plan Subscription</h6>
            <p>November 15, 2024 • PayPal</p>
          </div>
        </div>
        <div class="transaction-amount">
          <div class="amount">$299.99</div>
          <span class="status-badge status-success">Paid</span>
        </div>
      </div>

      <div class="transaction-item">
        <div class="transaction-left">
          <div class="transaction-icon transaction-failed">
            <i class="bi bi-x-circle-fill"></i>
          </div>
          <div class="transaction-details">
            <h6>Premium Plan Subscription</h6>
            <p>October 15, 2024 • Visa ****4242 (Expired)</p>
          </div>
        </div>
        <div class="transaction-amount">
          <div class="amount">$299.99</div>
          <span class="status-badge status-failed">Failed</span>
        </div>
      </div>
    </div>

    <!-- Spending Chart -->
    <div class="billing-card">
      <div class="card-header">
        <h3 class="card-title">
          <i class="bi bi-graph-up"></i>
          Spending Overview
        </h3>
        <select class="form-select" style="width: auto;" onchange="updateSpendingChart(this.value)">
          <option value="6months">Last 6 Months</option>
          <option value="year">Last Year</option>
          <option value="2years">Last 2 Years</option>
        </select>
      </div>

      <div class="chart-container">
        <canvas id="spendingChart"></canvas>
      </div>
    </div>

    <!-- Billing Address -->
    <div class="billing-card">
      <div class="card-header">
        <h3 class="card-title">
          <i class="bi bi-geo-alt"></i>
          Billing Address
        </h3>
        <button class="btn-action btn-secondary" onclick="editBillingAddress()">
          <i class="bi bi-pencil"></i>
          Edit Address
        </button>
      </div>

      <div class="row">
        <div class="col-md-6">
          <p><strong>Tech Startup Inc</strong></p>
          <p>123 Business Avenue<br>
          Suite 100<br>
          San Francisco, CA 94105<br>
          United States</p>
        </div>
        <div class="col-md-6">
          <p><strong>Tax ID:</strong> 12-3456789</p>
          <p><strong>Contact:</strong> billing@techstartup.com</p>
          <p><strong>Phone:</strong> +1 (555) 123-4567</p>
        </div>
      </div>
    </div>
  </main>

  <script src="auth.js"></script>
  <script src="theme-manager.js"></script>
  <script src="load-sidebar.js"></script>
  
  <script>
    // Authentication check
    if (!vbmsAuth.isAuthenticated()) {
      console.log('Not authenticated - redirecting to customer login');
      window.location.href = 'customer-login.html';
    }

    // Sample billing data
    const billingData = {
      currentPlan: {
        name: 'Premium Plan',
        price: 299.99,
        currency: 'USD',
        billingCycle: 'monthly',
        nextBilling: '2025-02-15',
        features: [
          'Unlimited Orders Processing',
          'Advanced Analytics Dashboard', 
          'Multi-Platform Integration',
          'Priority Customer Support',
          'Advanced Inventory Management',
          'Custom Reporting Tools'
        ]
      },
      paymentMethods: [
        {
          id: 'pm_1',
          type: 'visa',
          last4: '4242',
          expiry: '12/2027',
          isDefault: true
        },
        {
          id: 'pm_2', 
          type: 'paypal',
          email: 'user@example.com',
          isDefault: false
        }
      ],
      transactions: [
        {
          id: 'txn_001',
          description: 'Premium Plan Subscription',
          amount: 299.99,
          currency: 'USD',
          date: '2025-01-15',
          status: 'paid',
          paymentMethod: 'Visa ****4242'
        },
        {
          id: 'txn_002',
          description: 'Premium Plan Subscription', 
          amount: 299.99,
          currency: 'USD',
          date: '2024-12-15',
          status: 'paid',
          paymentMethod: 'Visa ****4242'
        },
        {
          id: 'txn_003',
          description: 'Premium Plan Subscription',
          amount: 299.99,
          currency: 'USD', 
          date: '2024-11-15',
          status: 'paid',
          paymentMethod: 'PayPal'
        },
        {
          id: 'txn_004',
          description: 'Premium Plan Subscription',
          amount: 299.99,
          currency: 'USD',
          date: '2024-10-15', 
          status: 'failed',
          paymentMethod: 'Visa ****4242 (Expired)'
        }
      ],
      spendingData: {
        labels: ['Aug 2024', 'Sep 2024', 'Oct 2024', 'Nov 2024', 'Dec 2024', 'Jan 2025'],
        data: [299.99, 299.99, 0, 299.99, 299.99, 299.99]
      }
    };

    // Initialize spending chart
    let spendingChart;
    function initializeSpendingChart() {
      const ctx = document.getElementById('spendingChart').getContext('2d');
      
      spendingChart = new Chart(ctx, {
        type: 'line',
        data: {
          labels: billingData.spendingData.labels,
          datasets: [{
            label: 'Monthly Spending',
            data: billingData.spendingData.data,
            borderColor: '#f0b90b',
            backgroundColor: 'rgba(240, 185, 11, 0.1)',
            borderWidth: 3,
            fill: true,
            tension: 0.4,
            pointBackgroundColor: '#f0b90b',
            pointBorderColor: '#ffffff',
            pointBorderWidth: 2,
            pointRadius: 6,
            pointHoverRadius: 8
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          plugins: {
            legend: {
              display: false
            }
          },
          scales: {
            y: {
              beginAtZero: true,
              grid: {
                color: 'rgba(0, 0, 0, 0.1)'
              },
              ticks: {
                callback: function(value) {
                  return '$' + value;
                }
              }
            },
            x: {
              grid: {
                color: 'rgba(0, 0, 0, 0.1)'
              }
            }
          },
          elements: {
            point: {
              hoverBackgroundColor: '#ffd700'
            }
          }
        }
      });
    }

    function updateSpendingChart(period) {
      // Update chart based on selected period
      console.log('Updating spending chart for period:', period);
      
      let newLabels, newData;
      
      switch(period) {
        case '6months':
          newLabels = ['Aug 2024', 'Sep 2024', 'Oct 2024', 'Nov 2024', 'Dec 2024', 'Jan 2025'];
          newData = [299.99, 299.99, 0, 299.99, 299.99, 299.99];
          break;
        case 'year':
          newLabels = ['Feb 2024', 'Mar 2024', 'Apr 2024', 'May 2024', 'Jun 2024', 'Jul 2024', 'Aug 2024', 'Sep 2024', 'Oct 2024', 'Nov 2024', 'Dec 2024', 'Jan 2025'];
          newData = [299.99, 299.99, 299.99, 299.99, 299.99, 299.99, 299.99, 299.99, 0, 299.99, 299.99, 299.99];
          break;
        case '2years':
          newLabels = ['Q1 2023', 'Q2 2023', 'Q3 2023', 'Q4 2023', 'Q1 2024', 'Q2 2024', 'Q3 2024', 'Q4 2024'];
          newData = [899.97, 899.97, 899.97, 899.97, 899.97, 899.97, 899.97, 599.98];
          break;
      }
      
      spendingChart.data.labels = newLabels;
      spendingChart.data.datasets[0].data = newData;
      spendingChart.update();
    }

    // Payment method functions
    function addPaymentMethod() {
      showPaymentMethodModal();
    }

    function editPaymentMethod(methodId) {
      const method = billingData.paymentMethods.find(pm => pm.id === methodId);
      if (method) {
        showPaymentMethodModal(method);
      }
    }

    function deletePaymentMethod(methodId) {
      if (confirm('Are you sure you want to remove this payment method?')) {
        console.log('Deleting payment method:', methodId);
        // In a real app, this would make an API call
        alert('Payment method removed successfully');
      }
    }

    function setDefaultPayment(methodId) {
      console.log('Setting default payment method:', methodId);
      alert('Payment method set as default');
    }

    function showPaymentMethodModal(method = null) {
      const isEdit = method !== null;
      const modal = document.createElement('div');
      modal.className = 'modal-overlay';
      modal.innerHTML = `
        <div class="modal">
          <div class="modal-header">
            <h3>
              <i class="bi bi-credit-card"></i>
              ${isEdit ? 'Edit' : 'Add'} Payment Method
            </h3>
            <button class="modal-close" onclick="closeModal()">
              <i class="bi bi-x"></i>
            </button>
          </div>
          <form id="paymentMethodForm">
            <div class="form-group">
              <label for="paymentType">Payment Type</label>
              <select id="paymentType" ${isEdit ? 'disabled' : ''}>
                <option value="credit_card" ${method?.type === 'visa' || method?.type === 'mastercard' ? 'selected' : ''}>Credit Card</option>
                <option value="paypal" ${method?.type === 'paypal' ? 'selected' : ''}>PayPal</option>
                <option value="bank_account">Bank Account</option>
              </select>
            </div>
            <div id="creditCardFields" style="display: ${method?.type === 'visa' || method?.type === 'mastercard' || !method ? 'block' : 'none'};">
              <div class="form-group">
                <label for="cardNumber">Card Number</label>
                <input type="text" id="cardNumber" placeholder="1234 5678 9012 3456" ${isEdit ? 'disabled' : ''} value="${method?.last4 ? '****' + method.last4 : ''}">
              </div>
              <div class="row">
                <div class="col-6">
                  <div class="form-group">
                    <label for="expiryDate">Expiry Date</label>
                    <input type="text" id="expiryDate" placeholder="MM/YY" value="${method?.expiry || ''}">
                  </div>
                </div>
                <div class="col-6">
                  <div class="form-group">
                    <label for="cvv">CVV</label>
                    <input type="text" id="cvv" placeholder="123" ${isEdit ? 'disabled' : ''}>
                  </div>
                </div>
              </div>
            </div>
            <div id="paypalFields" style="display: ${method?.type === 'paypal' ? 'block' : 'none'};">
              <div class="form-group">
                <label for="paypalEmail">PayPal Email</label>
                <input type="email" id="paypalEmail" placeholder="your-email@example.com" value="${method?.email || ''}">
              </div>
            </div>
            <div class="modal-actions">
              <button type="button" class="btn-action btn-secondary" onclick="closeModal()">Cancel</button>
              <button type="submit" class="btn-action btn-primary">
                ${isEdit ? 'Update' : 'Add'} Payment Method
              </button>
            </div>
          </form>
        </div>
      `;
      
      document.body.appendChild(modal);
      setTimeout(() => modal.classList.add('show'), 10);
      
      // Handle payment type change
      document.getElementById('paymentType').addEventListener('change', function() {
        const creditCardFields = document.getElementById('creditCardFields');
        const paypalFields = document.getElementById('paypalFields');
        
        if (this.value === 'credit_card') {
          creditCardFields.style.display = 'block';
          paypalFields.style.display = 'none';
        } else if (this.value === 'paypal') {
          creditCardFields.style.display = 'none';
          paypalFields.style.display = 'block';
        } else {
          creditCardFields.style.display = 'none';
          paypalFields.style.display = 'none';
        }
      });
      
      // Handle form submission
      document.getElementById('paymentMethodForm').addEventListener('submit', function(e) {
        e.preventDefault();
        console.log('Payment method form submitted');
        alert(isEdit ? 'Payment method updated successfully' : 'Payment method added successfully');
        closeModal();
      });
      
      modal.addEventListener('click', (e) => {
        if (e.target === modal) closeModal();
      });
    }

    // Plan management functions
    function changePlan() {
      alert('Plan change functionality would be implemented here');
    }

    function cancelSubscription() {
      if (confirm('Are you sure you want to cancel your subscription? You will lose access to premium features at the end of your current billing period.')) {
        alert('Subscription cancellation requested. You will receive a confirmation email shortly.');
      }
    }

    // Transaction functions
    function viewAllTransactions() {
      alert('Redirecting to full transaction history...');
    }

    // Billing address function
    function editBillingAddress() {
      const modal = document.createElement('div');
      modal.className = 'modal-overlay';
      modal.innerHTML = `
        <div class="modal">
          <div class="modal-header">
            <h3>
              <i class="bi bi-geo-alt"></i>
              Edit Billing Address
            </h3>
            <button class="modal-close" onclick="closeModal()">
              <i class="bi bi-x"></i>
            </button>
          </div>
          <form id="billingAddressForm">
            <div class="form-group">
              <label for="companyName">Company Name</label>
              <input type="text" id="companyName" value="Tech Startup Inc">
            </div>
            <div class="form-group">
              <label for="address1">Address Line 1</label>
              <input type="text" id="address1" value="123 Business Avenue">
            </div>
            <div class="form-group">
              <label for="address2">Address Line 2</label>
              <input type="text" id="address2" value="Suite 100">
            </div>
            <div class="row">
              <div class="col-6">
                <div class="form-group">
                  <label for="city">City</label>
                  <input type="text" id="city" value="San Francisco">
                </div>
              </div>
              <div class="col-6">
                <div class="form-group">
                  <label for="state">State</label>
                  <input type="text" id="state" value="CA">
                </div>
              </div>
            </div>
            <div class="row">
              <div class="col-6">
                <div class="form-group">
                  <label for="zipCode">ZIP Code</label>
                  <input type="text" id="zipCode" value="94105">
                </div>
              </div>
              <div class="col-6">
                <div class="form-group">
                  <label for="country">Country</label>
                  <select id="country">
                    <option value="US" selected>United States</option>
                    <option value="CA">Canada</option>
                    <option value="UK">United Kingdom</option>
                  </select>
                </div>
              </div>
            </div>
            <div class="form-group">
              <label for="taxId">Tax ID</label>
              <input type="text" id="taxId" value="12-3456789">
            </div>
            <div class="modal-actions">
              <button type="button" class="btn-action btn-secondary" onclick="closeModal()">Cancel</button>
              <button type="submit" class="btn-action btn-primary">Update Address</button>
            </div>
          </form>
        </div>
      `;
      
      document.body.appendChild(modal);
      setTimeout(() => modal.classList.add('show'), 10);
      
      document.getElementById('billingAddressForm').addEventListener('submit', function(e) {
        e.preventDefault();
        console.log('Billing address updated');
        alert('Billing address updated successfully');
        closeModal();
      });
      
      modal.addEventListener('click', (e) => {
        if (e.target === modal) closeModal();
      });
    }

    function closeModal() {
      const modal = document.querySelector('.modal-overlay');
      if (modal) {
        modal.classList.remove('show');
        setTimeout(() => modal.remove(), 300);
      }
    }

    function logout() {
      vbmsAuth.logout();
    }

    // Initialize the page
    document.addEventListener('DOMContentLoaded', function() {
      initializeSpendingChart();
      
      console.log('Customer Billing page initialized');
    });
  </script>
</body>
</html>